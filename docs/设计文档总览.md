# SQLCC数据库管理系统 - 设计文档总览

本文档提供SQLCC数据库管理系统各子系统的需求和设计总览，作为系统整体架构的导航参考。

## 系统架构概览

SQLCC采用模块化的客户端-服务器架构，主要包含以下核心子系统：

1. **SQL解析器** - 负责SQL语句的词法分析和语法分析，生成抽象语法树
2. **SQL执行器** - 执行解析后的SQL语句，管理表元数据和约束
3. **存储引擎** - 负责数据的物理存储和管理，包括页面管理和缓冲池
4. **事务管理器** - 确保事务的ACID特性，提供并发控制和死锁检测
5. **配置管理器** - 管理系统配置参数，提供配置加载和访问功能
6. **网络模块** - 实现客户端-服务器通信，支持远程访问

## 1. SQL解析器子系统

### 需求概述
- 将用户输入的SQL文本解析为结构化的抽象语法树(AST)
- 支持多种SQL语句类型，包括DDL、DML、DCL和事务控制语句
- 提供清晰的语法错误提示和错误处理机制
- 支持AST的遍历和访问，便于后续处理

### 设计特点
- 采用经典的编译器前端架构，包括词法分析器(Lexer)和语法分析器(Parser)
- 生成的AST支持多种SQL语句类型的结构化表示
- 提供Token类表示SQL语言中的各种标记元素
- 模块化设计便于扩展和维护

### 核心组件
- **Lexer** - 词法分析器，将SQL文本分解为Token流
- **Parser** - 语法分析器，将Token流构建为抽象语法树
- **Token** - 表示SQL语言中的各种标记
- **AST Nodes** - 抽象语法树节点类

## 2. SQL执行器子系统

### 需求概述
- 执行各类SQL语句，包括DDL、DML、DCL和事务控制语句
- 管理表结构和约束信息
- 执行记录的增删改查操作
- 在数据操作前后验证表约束
- 与事务管理器集成，提供ACID事务保证

### 设计特点
- 模块化设计，不同类型的SQL语句执行分离到独立方法
- 完善的异常处理机制确保系统稳定
- 线程安全设计通过互斥锁保护并发访问
- 易于扩展，支持添加新的SQL语句类型

### 核心组件
- **SqlExecutor** - SQL执行器主类
- **TableMetadata** - 表元数据管理
- **Record** - 记录操作类
- **ConstraintExecutor** - 约束验证
- **WhereCondition** - 查询条件处理

## 3. 存储引擎子系统

### 需求概述
- 管理数据库的物理存储结构
- 提供页面管理机制，支持页面的创建、获取、刷新和删除
- 实现缓冲池管理，提高I/O性能
- 管理索引结构，支持高效数据检索
- 确保数据的持久性和一致性

### 设计特点
- 基于页面的存储模型，便于管理和优化
- 缓冲池机制减少磁盘I/O操作
- 集成索引管理器，提供高效的数据访问路径
- 统一的存储接口，便于上层组件访问

### 核心组件
- **StorageEngine** - 存储引擎主类
- **DiskManager** - 磁盘管理器，负责与物理存储交互
- **BufferPool** - 缓冲池，管理内存中的页面缓存
- **IndexManager** - 索引管理器，提供索引操作

## 4. 事务管理器子系统

### 需求概述
- 实现ACID事务特性，确保数据一致性和完整性
- 提供并发控制机制，协调多个事务的执行
- 实现死锁检测和处理机制
- 提供预写日志(WAL)机制，确保事务持久性
- 支持多种事务隔离级别

### 设计特点
- 基于两阶段锁协议(2PL)实现事务并发控制
- 预写日志机制确保事务持久性和系统崩溃恢复
- 基于等待图的死锁检测算法
- 灵活的隔离级别支持

### 核心组件
- **TransactionManager** - 事务管理器主类
- **Transaction** - 表示单个事务的状态和信息
- **LogEntry** - 日志条目，用于预写日志机制
- 锁管理和死锁检测模块

## 5. 配置管理器子系统

### 需求概述
- 管理系统配置参数，提供统一的配置访问接口
- 支持配置的加载、解析和验证
- 提供配置参数的类型转换和默认值处理
- 支持配置的动态更新和持久化

### 设计特点
- 统一的配置管理接口，简化配置访问
- 类型安全的配置值处理
- 支持多种配置源，如配置文件、环境变量等
- 配置验证机制确保配置合法性

### 核心组件
- **ConfigManager** - 配置管理器主类
- **ConfigValue** - 配置值类，提供类型转换和验证

## 6. 网络模块子系统

### 需求概述
- 实现客户端-服务器通信协议
- 支持并发连接处理，提高系统吞吐量
- 提供请求序列化和响应反序列化功能
- 实现网络错误处理和连接管理
- 确保数据传输的安全性和可靠性

### 设计特点
- 分层设计，清晰的模块划分
- 支持多线程并发处理客户端连接
- 高效的序列化机制，优化网络传输性能
- 完善的错误处理和连接恢复机制

### 核心组件
- 服务器和客户端通信组件
- 请求处理和响应生成模块
- 序列化库
- 连接池和线程管理

## 文档索引

| 子系统 | 主要文档 | 位置 |
|-------|---------|------|
| 系统架构 | Architecture.md | docs/design/ |
| SQL解析器 | sql_parser-总体设计.md | docs/design/sql_parser/ |
| SQL执行器 | sql_executor-总体设计.md | docs/design/sql_executor/ |
| 事务管理器 | transaction_manager-总体设计.md | docs/design/transaction_manager/ |
| 配置管理器 | config_manager-总体设计.md | docs/design/config_manager/ |
| 网络模块 | NetworkArchitecture.md | docs/design/network/ |
| 存储引擎 | 相关文档 | docs/design/storage_engine/ |

## 后续工作

- 完善各子系统的详细设计文档
- 加强跨子系统交互的文档说明
- 添加性能测试和优化指南
- 提供部署和配置文档
- 更新系统升级和迁移指南