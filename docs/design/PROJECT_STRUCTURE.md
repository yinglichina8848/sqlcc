# SQLCC 项目目录结构与模块结构文档

## 1. 项目目录概览

SQLCC (Simple Compact Course Computer) 数据库系统采用了模块化、分层的目录结构设计，清晰地划分了源代码、头文件、测试、文档和配置等不同类型的资源。整体目录结构如下：

```
sqlcc/
├── .gitignore          # Git忽略文件配置
├── CHANGELOG.md        # 版本变更记录
├── CMakeLists.txt      # 主CMake构建脚本
├── Doxyfile            # Doxygen文档生成配置
├── LICENSE             # 许可证文件
├── Makefile            # Make构建脚本
├── README.md           # 项目说明文档(中文)
├── README.en.md        # 项目说明文档(英文)
├── VERSION             # 版本号文件
├── analysis/           # 性能分析报告和图表
├── bin/                # 可执行文件输出目录
├── config/             # 配置文件目录
├── coverage/           # 代码覆盖率报告
├── docs/               # 文档目录
├── examples/           # 示例代码
├── include/            # 头文件目录
├── scripts/            # 辅助脚本
├── src/                # 源代码目录
├── test/               # 测试目录(备用)
└── tests/              # 测试目录
```

## 2. 核心目录详细说明

### 2.1 src/ - 源代码目录

源代码目录是项目的核心，包含了所有的实现文件。源代码按照模块功能进行组织，每个主要功能模块都有自己的子目录。

```
src/
├── CMakeLists.txt            # src目录CMake构建脚本
├── config_manager/           # 配置管理器实现
├── database_manager.cpp      # 数据库管理器实现
├── dml_test.cpp              # DML测试程序
├── isql_main.cpp             # 交互式SQL客户端入口
├── main.cpp                  # 数据库服务器入口
├── network/                  # 网络模块实现
├── sql_executor/             # SQL执行器实现
├── sql_parser/               # SQL解析器实现
├── storage_engine/           # 存储引擎实现
└── transaction_manager/      # 事务管理器实现
```

**主要模块及其职责：**

| 模块名称 | 目录路径 | 主要职责 | 文件说明 |
|---------|---------|---------|--------|
| 配置管理器 | src/config_manager/ | 管理系统配置参数 | config_manager.cpp |
| 数据库管理器 | src/ | 管理数据库实例和生命周期 | database_manager.cpp |
| 网络模块 | src/network/ | 处理网络通信 | network.cpp |
| SQL执行器 | src/sql_executor/ | 执行SQL查询和更新 | sql_executor.cpp, constraint_executor.cpp等 |
| SQL解析器 | src/sql_parser/ | 解析SQL语句 | parser.cpp, lexer.cpp, ast_node.cpp等 |
| 存储引擎 | src/storage_engine/ | 管理数据存储和检索 | storage_engine.cpp, buffer_pool.cpp, disk_manager.cpp等 |
| 事务管理器 | src/transaction_manager/ | 管理事务和并发控制 | transaction_manager.cpp, wal_manager.cpp |

### 2.2 include/ - 头文件目录

头文件目录包含了所有公共接口定义，与src目录结构保持一致，便于模块间引用。

```
include/
├── b_plus_tree.h             # B+树索引结构定义
├── buffer_pool.h             # 缓冲池接口
├── config_manager.h          # 配置管理器接口
├── constraint_executor.h     # 约束执行器接口
├── data_type.h               # 数据类型定义
├── database_manager.h        # 数据库管理器接口
├── disk_manager.h            # 磁盘管理器接口
├── exception.h               # 异常类定义
├── logger.h                  # 日志记录接口
├── page.h                    # 页结构定义
├── sql_executor.h            # SQL执行器接口
├── storage_engine.h          # 存储引擎接口
├── transaction_manager.h     # 事务管理器接口
├── version.h                 # 版本信息
├── wal_manager.h             # WAL(预写式日志)管理器接口
├── config_manager/           # 配置管理器子模块头文件
├── network/                  # 网络模块子模块头文件
├── sql_executor/             # SQL执行器子模块头文件
├── sql_parser/               # SQL解析器子模块头文件
├── sqlcc/                    # SQLCC命名空间相关头文件
├── storage_engine/           # 存储引擎子模块头文件
└── transaction_manager/      # 事务管理器子模块头文件
```

### 2.3 docs/ - 文档目录

文档目录包含了项目的各种文档，包括设计文档、开发指南、性能分析报告等，按功能和类型进行分类。

```
docs/
├── BRANCHES.md                       # 分支管理说明
├── TODO.md                           # 待办事项
├── coverage_analysis_report.md       # 覆盖率分析报告
├── design/                           # 设计文档目录
├── development/                      # 开发相关文档
├── distributed/                      # 分布式相关设计
├── guides/                           # 开发指南
├── kimibook/                         # 知识库文档
├── performance/                      # 性能相关文档
├── releases/                         # 发布相关文档
├── reports/                          # 各种报告
├── testing/                          # 测试相关文档
└── textbook/                         # 教程文档
```

**设计文档子目录：**

```
docs/design/
├── Architecture.md                     # 系统架构文档
├── DESIGN_IMPROVEMENT_PLAN.md          # 设计改进计划
├── LOCKING_MECHANISM_ANALYSIS.md       # 锁机制分析
├── OVERALL_DESIGN.md                   # 总体设计文档
├── config_manager/                     # 配置管理器设计文档
├── network/                            # 网络模块设计文档
├── sql_executor/                       # SQL执行器设计文档
├── sql_parser/                         # SQL解析器设计文档
├── storage_engine/                     # 存储引擎设计文档
└── transaction_manager/                # 事务管理器设计文档
```

### 2.4 tests/ - 测试目录

测试目录包含了各种单元测试和集成测试文件，用于验证系统功能和稳定性。

### 2.5 examples/ - 示例代码目录

示例代码目录包含了一些简单的使用示例，帮助用户理解如何使用SQLCC的API和功能。

### 2.6 config/ - 配置文件目录

配置文件目录包含了系统运行所需的配置文件。

```
config/
├── sqlcc.conf          # 主配置文件
└── sqlcc_test.conf     # 测试配置文件
```

### 2.7 analysis/ - 性能分析目录

性能分析目录包含了各种性能测试结果和分析图表。

## 3. 模块结构与依赖关系

### 3.1 核心模块结构图

以下是SQLCC数据库系统的核心模块及其依赖关系：

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           客户端接口层                                   │
│  ┌──────────────────┐   ┌─────────────────────┐   ┌────────────────┐    │
│  │ 交互式SQL客户端   │   │     API客户端      │   │ 协议处理模块   │    │
│  └────────┬─────────┘   └──────────┬──────────┘   └────────┬───────┘    │
│           │                        │                        │           │
└───────────┼────────────────────────┼────────────────────────┼───────────┘
            │                        │                        │
┌───────────▼────────────────────────▼────────────────────────▼───────────┐
│                           服务器核心层                                   │
│  ┌──────────────────┐   ┌─────────────────────┐   ┌────────────────┐    │
│  │    会话管理      │   │     连接管理       │   │  请求路由模块  │    │
│  └────────┬─────────┘   └──────────┬──────────┘   └────────┬───────┘    │
│           │                        │                        │           │
└───────────┼────────────────────────┼────────────────────────┼───────────┘
            │                        │                        │
┌───────────▼───────────┐  ┌─────────▼───────────┐  ┌─────────▼───────────┐
│     SQL解析器模块     │  │     SQL执行器模块    │  │    配置管理模块     │
└───────────┬───────────┘  └─────────┬───────────┘  └─────────────────────┘
            │                        │
┌───────────▼────────────────────────▼───────────────────────────────────┐
│                           事务处理层                                   │
│  ┌──────────────────┐   ┌─────────────────────┐   ┌────────────────┐    │
│  │    事务管理器    │   │     锁管理器       │   │  WAL日志管理器  │    │
│  └────────┬─────────┘   └──────────┬──────────┘   └────────┬───────┘    │
│           │                        │                        │           │
└───────────┼────────────────────────┼────────────────────────┼───────────┘
            │                        │                        │
┌───────────▼───────────┐  ┌─────────▼───────────┐  ┌─────────▼───────────┐
│      存储引擎模块     │  │      索引系统模块    │  │     缓冲池模块      │
└───────────┬───────────┘  └─────────┬───────────┘  └─────────┬───────────┘
            │                        │                        │
└───────────┼────────────────────────┼────────────────────────┼───────────┘
            │                        │                        │
┌───────────▼────────────────────────▼────────────────────────▼───────────┐
│                           存储层                                      │
│  ┌──────────────────┐   ┌─────────────────────┐                        │
│  │    磁盘管理器    │   │      空间管理器     │                        │
│  └──────────────────┘   └─────────────────────┘                        │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 模块依赖关系表

| 模块名称 | 直接依赖的模块 | 被依赖的模块 | 主要职责 |
|---------|--------------|------------|--------|
| SQL解析器 | 无 | SQL执行器 | 解析SQL语句生成AST |
| SQL执行器 | SQL解析器, 事务管理器, 存储引擎, 索引系统 | 客户端接口 | 执行SQL查询和更新 |
| 事务管理器 | 存储引擎, WAL日志管理器, 锁管理器 | SQL执行器 | 管理事务ACID属性 |
| 锁管理器 | 无 | 事务管理器 | 实现并发控制锁机制 |
| WAL日志管理器 | 存储引擎 | 事务管理器 | 实现预写式日志 |
| 存储引擎 | 缓冲池, 磁盘管理器 | SQL执行器, 事务管理器, 索引系统 | 管理数据存储和访问 |
| 索引系统 | 存储引擎 | SQL执行器 | 提供快速数据检索 |
| 缓冲池 | 磁盘管理器 | 存储引擎 | 管理内存缓存 |
| 磁盘管理器 | 无 | 存储引擎, 缓冲池, WAL日志管理器 | 管理磁盘I/O操作 |
| 配置管理器 | 无 | 所有模块 | 管理系统配置 |
| 网络模块 | 无 | 客户端接口, 服务器核心 | 处理网络通信 |

## 4. 文件命名规范

SQLCC项目遵循以下文件命名规范：

### 4.1 源代码文件
- 实现文件使用 `.cpp` 后缀（之前部分文件使用 `.cc` 后缀，现已迁移）
- 文件名使用小写字母，单词间用下划线分隔
- 文件名通常与对应的头文件名相同

### 4.2 头文件
- 头文件使用 `.h` 后缀
- 文件名使用小写字母，单词间用下划线分隔
- 公共接口的头文件放在 `include/` 目录
- 模块内部使用的头文件放在对应模块的目录下

### 4.3 文档文件
- Markdown文档使用 `.md` 后缀
- 文件名使用大写字母，单词间用下划线分隔
- 文档按功能分类存放在 `docs/` 对应子目录

### 4.4 配置文件
- 配置文件使用 `.conf` 后缀
- 文件名使用小写字母，单词间用下划线分隔
- 配置文件存放在 `config/` 目录

## 5. 代码组织规范

### 5.1 目录结构规范
- 每个模块对应 `src/` 和 `include/` 下的同名目录
- 实现文件放在 `src/[模块名]/` 目录
- 头文件放在 `include/[模块名]/` 目录
- 公共接口的头文件可以放在 `include/` 根目录

### 5.2 头文件包含规范
- 包含系统头文件使用 `<>` 语法
- 包含项目头文件使用 `