# 事务管理器组件

## 概述

事务管理器是SQLCC数据库管理系统中确保数据一致性和完整性的核心组件。它实现了ACID事务特性，提供了并发控制、死锁检测和隔离级别支持等功能。

## 核心类

1. [TransactionManager](transaction_manager.md) - 事务管理器主类，负责事务的创建、提交、回滚等操作
2. [Transaction](transaction.md) - 事务类，表示单个事务的完整信息和状态
3. [LogEntry](log_entry.md) - 日志条目类，用于实现预写日志(WAL)机制

## 组件关系

```
TransactionManager
    |
    |-- Transaction (事务状态管理)
    |-- LogEntry (日志记录)
    |-- Lock Management (锁管理)
    `-- Deadlock Detection (死锁检测)
```

## 主要功能

1. **事务生命周期管理**：开始、提交、回滚事务
2. **隔离级别支持**：实现多种事务隔离级别
3. **并发控制**：使用两阶段锁协议(2PL)保证事务串行化
4. **死锁检测**：基于等待图和拓扑排序的死锁检测机制
5. **日志管理**：预写日志(WAL)机制，确保事务持久性
6. **保存点支持**：支持事务内的保存点创建和回滚

## 支持的隔离级别

1. **READ UNCOMMITTED** - 读未提交
2. **READ COMMITTED** - 读已提交
3. **REPEATABLE READ** - 可重复读
4. **SERIALIZABLE** - 可串行化

## 锁机制

1. **共享锁(S锁)**：用于读操作
2. **排他锁(X锁)**：用于写操作
3. **意向锁**：用于提高锁检查效率

## 死锁处理

1. **等待图构建**：记录事务间的等待关系
2. **拓扑排序检测**：检测循环等待情况
3. **回滚策略**：选择合适的事务进行回滚