# SQLCC数据库管理系统 - 用户手册

## 1. 系统概述

### 1.1 什么是SQLCC

SQLCC是一个简单的数据库管理系统，旨在提供基本的数据库功能，包括数据存储、查询、事务管理等。它采用模块化设计，便于扩展和维护，适合学习和教学使用。

### 1.2 主要功能

- 支持标准SQL语法，包括DDL、DML、DCL和事务控制语句
- 基于B+树索引的高效数据存储和检索
- 支持ACID事务特性
- 提供性能测试框架，便于评估系统性能
- 支持客户端-服务器架构，便于远程访问

### 1.3 系统架构

SQLCC采用模块化的客户端-服务器架构，主要包含以下核心组件：

1. **SQL解析器** - 负责SQL语句的词法和语法分析
2. **SQL执行器** - 执行解析后的SQL语句
3. **存储引擎** - 负责数据的物理存储和管理
4. **事务管理器** - 确保事务的ACID特性
5. **配置管理器** - 管理系统配置参数
6. **网络模块** - 实现客户端-服务器通信

## 2. 安装指南

### 2.1 系统要求

- 操作系统：Linux、macOS、Windows
- 编译器：支持C++17的编译器（如GCC 7+、Clang 5+、MSVC 2017+）
- 构建工具：CMake 3.10+
- 内存：至少1GB RAM
- 磁盘空间：至少100MB可用空间

### 2.2 编译安装

1. **克隆代码仓库**

```bash
git clone https://github.com/yourusername/sqlcc.git
cd sqlcc
```

2. **创建构建目录**

```bash
mkdir build
cd build
```

3. **配置CMake**

```bash
cmake ..
```

4. **编译**

```bash
make -j4
```

5. **安装**

```bash
sudo make install
```

### 2.3 验证安装

```bash
# 启动服务器
sqlcc-server

# 在另一个终端中启动客户端
sqlcc-client
```

如果能够成功启动服务器和客户端，则安装成功。

## 3. 快速开始

### 3.1 启动服务器

```bash
sqlcc-server --config config.ini
```

### 3.2 连接客户端

```bash
sqlcc-client --host localhost --port 3306
```

### 3.3 创建数据库

```sql
CREATE DATABASE test_db;
USE test_db;
```

### 3.4 创建表

```sql
CREATE TABLE users (
    id INT PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE,
    age INT CHECK (age >= 0)
);
```

### 3.5 插入数据

```sql
INSERT INTO users (id, name, email, age) VALUES (1, 'Alice', 'alice@example.com', 25);
INSERT INTO users (id, name, email, age) VALUES (2, 'Bob', 'bob@example.com', 30);
INSERT INTO users (id, name, email, age) VALUES (3, 'Charlie', 'charlie@example.com', 35);
```

### 3.6 查询数据

```sql
-- 查询所有用户
SELECT * FROM users;

-- 查询特定用户
SELECT * FROM users WHERE id = 1;

-- 查询年龄大于30的用户
SELECT * FROM users WHERE age > 30;

-- 按年龄排序
SELECT * FROM users ORDER BY age DESC;
```

### 3.7 更新数据

```sql
UPDATE users SET age = 26 WHERE id = 1;
```

### 3.8 删除数据

```sql
DELETE FROM users WHERE id = 3;
```

### 3.9 使用事务

```sql
BEGIN TRANSACTION;

INSERT INTO users (id, name, email, age) VALUES (4, 'David', 'david@example.com', 40);
UPDATE users SET age = 31 WHERE id = 2;

COMMIT;
```

## 4. 核心功能使用

### 4.1 数据定义语言（DDL）

#### 4.1.1 创建数据库

```sql
CREATE DATABASE database_name;
```

#### 4.1.2 删除数据库

```sql
DROP DATABASE database_name;
```

#### 4.1.3 使用数据库

```sql
USE database_name;
```

#### 4.1.4 创建表

```sql
CREATE TABLE table_name (
    column1 datatype constraint,
    column2 datatype constraint,
    ...
    PRIMARY KEY (column_name)
);
```

#### 4.1.5 修改表

```sql
-- 添加列
ALTER TABLE table_name ADD COLUMN column_name datatype constraint;

-- 修改列
ALTER TABLE table_name ALTER COLUMN column_name datatype;

-- 删除列
ALTER TABLE table_name DROP COLUMN column_name;
```

#### 4.1.6 删除表

```sql
DROP TABLE table_name;
```

### 4.2 数据操纵语言（DML）

#### 4.2.1 插入数据

```sql
-- 插入单行数据
INSERT INTO table_name (column1, column2, ...) VALUES (value1, value2, ...);

-- 插入多行数据
INSERT INTO table_name (column1, column2, ...) VALUES 
    (value1, value2, ...),
    (value1, value2, ...),
    ...;
```

#### 4.2.2 查询数据

```sql
-- 基本查询
SELECT column1, column2, ... FROM table_name;

-- 带条件查询
SELECT * FROM table_name WHERE condition;

-- 排序
SELECT * FROM table_name ORDER BY column_name ASC|DESC;

-- 分组
SELECT column1, COUNT(*) FROM table_name GROUP BY column1;

-- 限制结果数量
SELECT * FROM table_name LIMIT 10;

-- 范围查询
SELECT * FROM table_name WHERE column_name BETWEEN value1 AND value2;
```

#### 4.2.3 更新数据

```sql
UPDATE table_name SET column1 = value1, column2 = value2, ... WHERE condition;
```

#### 4.2.4 删除数据

```sql
DELETE FROM table_name WHERE condition;
```

### 4.3 事务控制

#### 4.3.1 开始事务

```sql
BEGIN TRANSACTION;
-- 或
START TRANSACTION;
```

#### 4.3.2 提交事务

```sql
COMMIT;
```

#### 4.3.3 回滚事务

```sql
ROLLBACK;
```

#### 4.3.4 保存点

```sql
SAVEPOINT savepoint_name;
ROLLBACK TO savepoint_name;
RELEASE SAVEPOINT savepoint_name;
```

### 4.4 数据控制语言（DCL）

#### 4.4.1 创建用户

```sql
CREATE USER username IDENTIFIED BY 'password';
```

#### 4.4.2 授权

```sql
GRANT privilege ON object TO user;
```

#### 4.4.3 撤销授权

```sql
REVOKE privilege ON object FROM user;
```

#### 4.4.4 删除用户

```sql
DROP USER username;
```

## 5. 客户端使用

### 5.1 命令行客户端

SQLCC提供了命令行客户端，用于连接到服务器并执行SQL语句。

#### 5.1.1 启动客户端

```bash
sqlcc-client [options]
```

#### 5.1.2 客户端选项

| 选项 | 描述 | 默认值 |
|------|------|--------|
| --host | 服务器主机名或IP地址 | localhost |
| --port | 服务器端口号 | 3306 |
| --user | 用户名 | root |
| --password | 密码 | 空 |
| --database | 数据库名称 | 无 |
| --help | 显示帮助信息 | 无 |

#### 5.1.3 客户端命令

- `\h` 或 `\help`：显示帮助信息
- `\d` 或 `\databases`：显示所有数据库
- `	` 或 `	ables`：显示当前数据库中的所有表
- `\c database` 或 `\connect database`：连接到指定数据库
- `\q` 或 `\quit`：退出客户端

### 5.2 编程接口

SQLCC提供了编程接口，便于开发者集成到自己的应用程序中。

#### 5.2.1 C++ API

```cpp
// 示例：连接到服务器
#include "client/client.h"

int main() {
    // 创建客户端
    Client client;
    
    // 连接到服务器
    if (client.connect("localhost", 3306, "root", "", "test_db")) {
        // 执行SQL语句
        ResultSet result = client.execute("SELECT * FROM users");
        
        // 处理结果
        while (result.next()) {
            int id = result.getInt("id");
            std::string name = result.getString("name");
            std::cout << "id: " << id << ", name: " << name << std::endl;
        }
        
        // 关闭连接
        client.disconnect();
    }
    
    return 0;
}
```

## 6. 性能测试

### 6.1 性能测试框架

SQLCC提供了性能测试框架，用于评估系统在不同场景下的性能表现。

### 6.2 运行性能测试

```bash
# 进入构建目录
cd build

# 运行性能测试
./tests/performance/performance_test --config ../tests/performance/config.json
```

### 6.3 测试配置

性能测试配置文件示例：

```json
{
    "test_type": "HighConcurrencyTransactionTest",
    "duration_ms": 60000,
    "thread_count": 4,
    "read_ratio": 0.7,
    "write_ratio": 0.3,
    "transaction_size": 10,
    "working_set_size": 1000
}
```

### 6.4 测试结果

性能测试结果将输出到控制台，包括以下指标：

- 吞吐量（ops/sec）
- 延迟分布（P50、P95、P99、P99.9）
- 错误率

## 7. 常见操作示例

### 7.1 创建和使用索引

```sql
-- 创建索引
CREATE INDEX idx_users_name ON users(name);

-- 使用索引查询
SELECT * FROM users WHERE name = 'Alice';

-- 删除索引
DROP INDEX idx_users_name;
```

### 7.2 执行复杂查询

```sql
-- 连接查询
SELECT u.name, o.order_id, o.amount 
FROM users u 
JOIN orders o ON u.id = o.user_id;

-- 子查询
SELECT * FROM users WHERE id IN (SELECT user_id FROM orders WHERE amount > 100);

-- 聚合函数
SELECT COUNT(*), AVG(age), MAX(age), MIN(age) FROM users;
```

### 7.3 导入和导出数据

```sql
-- 导出数据到文件
SELECT * FROM users INTO OUTFILE '/tmp/users.csv' FIELDS TERMINATED BY ',' ENCLOSED BY '"' LINES TERMINATED BY '\n';

-- 从文件导入数据
LOAD DATA INFILE '/tmp/users.csv' INTO TABLE users FIELDS TERMINATED BY ',' ENCLOSED BY '"' LINES TERMINATED BY '\n';
```

## 8. 最佳实践

### 8.1 数据库设计

- 合理设计表结构，避免冗余数据
- 为频繁查询的列创建索引
- 选择合适的数据类型，避免不必要的空间浪费
- 设计合理的主键和外键关系

### 8.2 查询优化

- 只查询需要的列，避免使用SELECT *
- 使用索引优化查询
- 避免在WHERE子句中使用函数或表达式，以免索引失效
- 合理使用JOIN，避免过多的表连接
- 使用LIMIT限制结果数量，避免返回过多数据

### 8.3 事务管理

- 保持事务短小精悍，避免长时间占用锁
- 合理设置事务隔离级别
- 避免在事务中执行耗时的操作
- 及时提交或回滚事务

### 8.4 性能调优

- 定期运行性能测试，监控系统性能
- 根据性能测试结果调整系统配置
- 优化查询语句，提高查询效率
- 考虑使用缓存，减少数据库访问

## 9. 故障排除

### 9.1 常见问题及解决方案

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|
| 无法连接到服务器 | 服务器未启动、端口号错误、网络问题 | 检查服务器是否启动、端口号是否正确、网络连接是否正常 |
| 查询返回空结果 | 表中没有数据、查询条件错误 | 检查表中是否有数据、查询条件是否正确 |
| 插入失败 | 违反约束（如主键重复、唯一约束冲突） | 检查插入的数据是否违反约束 |
| 事务回滚 | 违反ACID特性、死锁 | 检查事务逻辑、避免死锁 |
| 性能下降 | 索引设计不合理、查询语句优化不足 | 优化索引设计、优化查询语句 |

### 9.2 日志查看

SQLCC的日志文件位于`logs/`目录下，可以通过查看日志文件了解系统运行情况和错误信息。

```bash
# 查看最近的日志
tail -f logs/sqlcc.log
```

### 9.3 系统监控

可以使用系统监控工具（如top、vmstat、iostat等）监控SQLCC的资源使用情况，包括CPU、内存、磁盘I/O等。

## 10. 后续维护

### 10.1 定期备份

定期备份数据库，以防止数据丢失。

```bash
# 示例：使用mysqldump备份（如果兼容）
mysqldump -h localhost -P 3306 -u root -p test_db > test_db_backup.sql
```

### 10.2 定期优化

定期优化数据库，包括：

- 重建索引
- 优化表结构
- 清理无用数据

### 10.3 版本升级

定期升级SQLCC到最新版本，以获取新功能和性能改进。

```bash
# 示例：升级步骤
git pull origin main
cd build
cmake ..
make -j4
sudo make install
```

## 11. 联系和支持

### 11.1 文档资源

- [设计文档总览](设计文档总览.md)
- [API文档生成说明](API文档生成说明.md)
- [部署和配置指南](部署和配置指南.md)
- [系统升级和迁移指南](系统升级和迁移指南.md)
- [故障排除指南](故障排除指南.md)

### 11.2 社区支持

- GitHub Issues：https://github.com/yourusername/sqlcc/issues
- 邮件列表：sqlcc-users@example.com
- 论坛：https://forum.sqlcc.example.com

### 11.3 贡献指南

欢迎贡献代码、文档、测试用例等。请参考[贡献指南](CONTRIBUTING.md)了解如何参与项目开发。

## 12. 附录

### 12.1 数据类型

| 数据类型 | 描述 | 示例 |
|----------|------|------|
| INT | 整数类型 | 123 |
| BIGINT | 长整数类型 | 1234567890 |
| FLOAT | 单精度浮点数 | 3.14 |
| DOUBLE | 双精度浮点数 | 3.1415926535 |
| VARCHAR(n) | 可变长度字符串 | "hello" |
| CHAR(n) | 固定长度字符串 | "hello" |
| DATE | 日期类型 | '2025-11-28' |
| TIME | 时间类型 | '14:30:00' |
| DATETIME | 日期时间类型 | '2025-11-28 14:30:00' |
| BOOLEAN | 布尔类型 | TRUE/FALSE |

### 12.2 约束类型

| 约束类型 | 描述 |
|----------|------|
| PRIMARY KEY | 主键约束，唯一标识表中的每一行 |
| UNIQUE | 唯一约束，确保列中的值唯一 |
| NOT NULL | 非空约束，确保列中的值不为空 |
| CHECK | 检查约束，确保列中的值满足指定条件 |
| DEFAULT | 默认约束，为列设置默认值 |
| FOREIGN KEY | 外键约束，建立表之间的关系 |

### 12.3 事务隔离级别

| 隔离级别 | 描述 |
|----------|------|
| READ UNCOMMITTED | 允许读取未提交的数据，可能导致脏读、不可重复读、幻读 |
| READ COMMITTED | 只允许读取已提交的数据，避免脏读，但可能导致不可重复读、幻读 |
| REPEATABLE READ | 确保同一事务中多次读取同一数据返回相同结果，避免脏读、不可重复读，但可能导致幻读 |
| SERIALIZABLE | 最高隔离级别，确保事务串行执行，避免所有并发问题 |

通过本用户手册，您应该能够了解SQLCC数据库管理系统的基本功能和使用方法。如果您有任何问题或建议，请随时联系我们。