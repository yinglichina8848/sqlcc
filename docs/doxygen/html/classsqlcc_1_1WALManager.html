<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SQLCC: sqlcc::WALManager Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SQLCC<span id="projectnumber">&#160;0.2.3</span>
   </div>
   <div id="projectbrief">Simple C++ Database Storage Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('classsqlcc_1_1WALManager.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classsqlcc_1_1WALManager-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">sqlcc::WALManager Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsqlcc_1_1WALManager_1_1WALMetrics.html">WALMetrics</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a986bb1e76ab0b52b35684aa023271e63" id="r_a986bb1e76ab0b52b35684aa023271e63"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a986bb1e76ab0b52b35684aa023271e63">WALManager</a> (const std::string &amp;log_file_path, bool force_sync=false)</td></tr>
<tr class="separator:a986bb1e76ab0b52b35684aa023271e63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62deaec0e1a59a5da9f2953d1f96854e" id="r_a62deaec0e1a59a5da9f2953d1f96854e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a62deaec0e1a59a5da9f2953d1f96854e">~WALManager</a> ()</td></tr>
<tr class="separator:a62deaec0e1a59a5da9f2953d1f96854e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cd4656d2d3cbfe45e85829d8e4d4ba4" id="r_a8cd4656d2d3cbfe45e85829d8e4d4ba4"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a8cd4656d2d3cbfe45e85829d8e4d4ba4">Log</a> (<a class="el" href="structsqlcc_1_1LogRecord.html">LogRecord</a> record)</td></tr>
<tr class="separator:a8cd4656d2d3cbfe45e85829d8e4d4ba4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea741255621a6d0c4003ceddcb48b4bc" id="r_aea741255621a6d0c4003ceddcb48b4bc"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#aea741255621a6d0c4003ceddcb48b4bc">LogBatch</a> (const std::vector&lt; <a class="el" href="structsqlcc_1_1LogRecord.html">LogRecord</a> &gt; &amp;records)</td></tr>
<tr class="separator:aea741255621a6d0c4003ceddcb48b4bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2182448d5fe30eab8a1edb19ea4ac7c2" id="r_a2182448d5fe30eab8a1edb19ea4ac7c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a2182448d5fe30eab8a1edb19ea4ac7c2">ForceFlush</a> ()</td></tr>
<tr class="separator:a2182448d5fe30eab8a1edb19ea4ac7c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a570b367959d33641bf78e78ed080abc4" id="r_a570b367959d33641bf78e78ed080abc4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a570b367959d33641bf78e78ed080abc4">AsyncFlush</a> ()</td></tr>
<tr class="separator:a570b367959d33641bf78e78ed080abc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a113274a046fac18d8dfae2dd43518ff3" id="r_a113274a046fac18d8dfae2dd43518ff3"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structsqlcc_1_1LogRecord.html">LogRecord</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a113274a046fac18d8dfae2dd43518ff3">ReadLogRange</a> (uint64_t from_lsn, uint64_t to_lsn)</td></tr>
<tr class="separator:a113274a046fac18d8dfae2dd43518ff3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1720a736a0404f67c27eae5027a37ee5" id="r_a1720a736a0404f67c27eae5027a37ee5"><td class="memItemLeft" align="right" valign="top">std::unordered_map&lt; std::string, std::string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a1720a736a0404f67c27eae5027a37ee5">AnalyzeLog</a> () const</td></tr>
<tr class="separator:a1720a736a0404f67c27eae5027a37ee5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07e24136b76e8844bac420b4b156f84a" id="r_a07e24136b76e8844bac420b4b156f84a"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a07e24136b76e8844bac420b4b156f84a">CreateCheckpoint</a> (bool sync=true)</td></tr>
<tr class="separator:a07e24136b76e8844bac420b4b156f84a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a978a77f99e2ed7e461362508d691974c" id="r_a978a77f99e2ed7e461362508d691974c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structsqlcc_1_1CheckpointState.html">CheckpointState</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a978a77f99e2ed7e461362508d691974c">GetLastCheckpoint</a> () const</td></tr>
<tr class="separator:a978a77f99e2ed7e461362508d691974c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95788376c9417f992faa13a362166d4e" id="r_a95788376c9417f992faa13a362166d4e"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structsqlcc_1_1CheckpointState.html">CheckpointState</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a95788376c9417f992faa13a362166d4e">GetCheckpointHistory</a> () const</td></tr>
<tr class="separator:a95788376c9417f992faa13a362166d4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83952d3e6e769b49573f7484c2b1a8a5" id="r_a83952d3e6e769b49573f7484c2b1a8a5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a83952d3e6e769b49573f7484c2b1a8a5">RecoverFromLog</a> ()</td></tr>
<tr class="separator:a83952d3e6e769b49573f7484c2b1a8a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a091dca265b65e1f5e39982209f4c4b15" id="r_a091dca265b65e1f5e39982209f4c4b15"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="namespacesqlcc.html#a39e312beb85ecaf1f79763e7ce9d1b22">TransactionId</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a091dca265b65e1f5e39982209f4c4b15">GetInProgressTransactions</a> () const</td></tr>
<tr class="separator:a091dca265b65e1f5e39982209f4c4b15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44127a7061391dc317ac29b31dbad139" id="r_a44127a7061391dc317ac29b31dbad139"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a44127a7061391dc317ac29b31dbad139">ReplayLog</a> (uint64_t from_lsn, uint64_t to_lsn)</td></tr>
<tr class="separator:a44127a7061391dc317ac29b31dbad139"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec3e8eed99b436afb135eb6f6f963fab" id="r_aec3e8eed99b436afb135eb6f6f963fab"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structsqlcc_1_1WALManager_1_1WALMetrics.html">WALMetrics</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#aec3e8eed99b436afb135eb6f6f963fab">GetMetrics</a> () const</td></tr>
<tr class="separator:aec3e8eed99b436afb135eb6f6f963fab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5759f104e31d16be56a63582116f9320" id="r_a5759f104e31d16be56a63582116f9320"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a5759f104e31d16be56a63582116f9320">ResetMetrics</a> ()</td></tr>
<tr class="separator:a5759f104e31d16be56a63582116f9320"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ef484e2e52bc4b154a977fb4c1bba8e" id="r_a0ef484e2e52bc4b154a977fb4c1bba8e"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a0ef484e2e52bc4b154a977fb4c1bba8e">CompactLog</a> (uint64_t keep_lsn)</td></tr>
<tr class="separator:a0ef484e2e52bc4b154a977fb4c1bba8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3e4dcb4d837804376152765cf02465e" id="r_ab3e4dcb4d837804376152765cf02465e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#ab3e4dcb4d837804376152765cf02465e">VerifyLogIntegrity</a> () const</td></tr>
<tr class="separator:ab3e4dcb4d837804376152765cf02465e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a074d5c37e0a0d7b55a9abd1dee3b5680" id="r_a074d5c37e0a0d7b55a9abd1dee3b5680"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a074d5c37e0a0d7b55a9abd1dee3b5680">InitializeLogFile</a> ()</td></tr>
<tr class="separator:a074d5c37e0a0d7b55a9abd1dee3b5680"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38c8b378145939d8285b19cbf556933a" id="r_a38c8b378145939d8285b19cbf556933a"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a38c8b378145939d8285b19cbf556933a">GenerateLSN</a> ()</td></tr>
<tr class="separator:a38c8b378145939d8285b19cbf556933a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fad927d4160a13c505e6266523bc21f" id="r_a7fad927d4160a13c505e6266523bc21f"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a7fad927d4160a13c505e6266523bc21f">WriteRecordsToDisk</a> (const std::vector&lt; <a class="el" href="structsqlcc_1_1LogRecord.html">LogRecord</a> &gt; &amp;records)</td></tr>
<tr class="separator:a7fad927d4160a13c505e6266523bc21f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9b839bfd1a04c5e1195263a16354662" id="r_ac9b839bfd1a04c5e1195263a16354662"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structsqlcc_1_1LogRecord.html">LogRecord</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#ac9b839bfd1a04c5e1195263a16354662">ReadRecordFromDisk</a> (uint64_t lsn)</td></tr>
<tr class="separator:ac9b839bfd1a04c5e1195263a16354662"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac381c367099dca75a6ea373c963c8154" id="r_ac381c367099dca75a6ea373c963c8154"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#ac381c367099dca75a6ea373c963c8154">WriteCheckpointToDisk</a> (const <a class="el" href="structsqlcc_1_1CheckpointState.html">CheckpointState</a> &amp;checkpoint)</td></tr>
<tr class="separator:ac381c367099dca75a6ea373c963c8154"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9353abd74630d042dd207b4610ead150" id="r_a9353abd74630d042dd207b4610ead150"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structsqlcc_1_1CheckpointState.html">CheckpointState</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a9353abd74630d042dd207b4610ead150">ReadCheckpointFromDisk</a> () const</td></tr>
<tr class="separator:a9353abd74630d042dd207b4610ead150"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a590724cc46a80d7e002f10abdf6d5679" id="r_a590724cc46a80d7e002f10abdf6d5679"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a590724cc46a80d7e002f10abdf6d5679">AsyncFlushThread</a> ()</td></tr>
<tr class="separator:a590724cc46a80d7e002f10abdf6d5679"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0379f4c4b5f2a79ae5305ea234c85300" id="r_a0379f4c4b5f2a79ae5305ea234c85300"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a0379f4c4b5f2a79ae5305ea234c85300">WALManager</a> (const <a class="el" href="classsqlcc_1_1WALManager.html">WALManager</a> &amp;)=delete</td></tr>
<tr class="separator:a0379f4c4b5f2a79ae5305ea234c85300"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32be7c9eb54a8f234c2b928176abf524" id="r_a32be7c9eb54a8f234c2b928176abf524"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classsqlcc_1_1WALManager.html">WALManager</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a32be7c9eb54a8f234c2b928176abf524">operator=</a> (const <a class="el" href="classsqlcc_1_1WALManager.html">WALManager</a> &amp;)=delete</td></tr>
<tr class="separator:a32be7c9eb54a8f234c2b928176abf524"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:ad29ce65e1ab00ed57e4d79c65a99e44a" id="r_ad29ce65e1ab00ed57e4d79c65a99e44a"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#ad29ce65e1ab00ed57e4d79c65a99e44a">log_file_path_</a></td></tr>
<tr class="separator:ad29ce65e1ab00ed57e4d79c65a99e44a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae73989908d2b65d7a9c7b671143c8db3" id="r_ae73989908d2b65d7a9c7b671143c8db3"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#ae73989908d2b65d7a9c7b671143c8db3">checkpoint_file_path_</a></td></tr>
<tr class="separator:ae73989908d2b65d7a9c7b671143c8db3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab66b3d926874bb5347f825e4c73f627b" id="r_ab66b3d926874bb5347f825e4c73f627b"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; uint64_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#ab66b3d926874bb5347f825e4c73f627b">next_lsn_</a></td></tr>
<tr class="separator:ab66b3d926874bb5347f825e4c73f627b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41b15908cf56904fb80a53040b4d0025" id="r_a41b15908cf56904fb80a53040b4d0025"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; uint64_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a41b15908cf56904fb80a53040b4d0025">last_flushed_lsn_</a></td></tr>
<tr class="separator:a41b15908cf56904fb80a53040b4d0025"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea56fc2bf3f9578154648a3f4ff033dc" id="r_aea56fc2bf3f9578154648a3f4ff033dc"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; uint64_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#aea56fc2bf3f9578154648a3f4ff033dc">last_checkpoint_lsn_</a></td></tr>
<tr class="separator:aea56fc2bf3f9578154648a3f4ff033dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70af2e5f3016d1d2470f18e9c0077897" id="r_a70af2e5f3016d1d2470f18e9c0077897"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structsqlcc_1_1LogRecord.html">LogRecord</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a70af2e5f3016d1d2470f18e9c0077897">log_buffer_</a></td></tr>
<tr class="separator:a70af2e5f3016d1d2470f18e9c0077897"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a584e5bde2e635c8f4ae2891b4931f306" id="r_a584e5bde2e635c8f4ae2891b4931f306"><td class="memItemLeft" align="right" valign="top">std::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a584e5bde2e635c8f4ae2891b4931f306">buffer_mutex_</a></td></tr>
<tr class="separator:a584e5bde2e635c8f4ae2891b4931f306"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19894317c8741ac6fc0f8b786ee58774" id="r_a19894317c8741ac6fc0f8b786ee58774"><td class="memItemLeft" align="right" valign="top">std::condition_variable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a19894317c8741ac6fc0f8b786ee58774">buffer_cv_</a></td></tr>
<tr class="separator:a19894317c8741ac6fc0f8b786ee58774"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28811031c46cf1a8e034f41df715bb24" id="r_a28811031c46cf1a8e034f41df715bb24"><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; std::thread &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a28811031c46cf1a8e034f41df715bb24">flush_thread_</a></td></tr>
<tr class="separator:a28811031c46cf1a8e034f41df715bb24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58f40b4c377e50777666692517c16fb3" id="r_a58f40b4c377e50777666692517c16fb3"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a58f40b4c377e50777666692517c16fb3">stop_flush_thread_</a></td></tr>
<tr class="separator:a58f40b4c377e50777666692517c16fb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cfa568f0b7af8a6635b714b55b9f557" id="r_a6cfa568f0b7af8a6635b714b55b9f557"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a6cfa568f0b7af8a6635b714b55b9f557">force_sync_</a></td></tr>
<tr class="separator:a6cfa568f0b7af8a6635b714b55b9f557"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad91c54a36b39904be7e76f75ae7177a4" id="r_ad91c54a36b39904be7e76f75ae7177a4"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#ad91c54a36b39904be7e76f75ae7177a4">flush_interval_ms_</a></td></tr>
<tr class="separator:ad91c54a36b39904be7e76f75ae7177a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2499798b907264408950dc8889ee785" id="r_ab2499798b907264408950dc8889ee785"><td class="memItemLeft" align="right" valign="top">std::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#ab2499798b907264408950dc8889ee785">metrics_mutex_</a></td></tr>
<tr class="separator:ab2499798b907264408950dc8889ee785"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a887731813def7012ce73bad9c6940e4d" id="r_a887731813def7012ce73bad9c6940e4d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structsqlcc_1_1WALManager_1_1WALMetrics.html">WALMetrics</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a></td></tr>
<tr class="separator:a887731813def7012ce73bad9c6940e4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adee37c93eff7a274e513b99cf03d0e48" id="r_adee37c93eff7a274e513b99cf03d0e48"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structsqlcc_1_1CheckpointState.html">CheckpointState</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#adee37c93eff7a274e513b99cf03d0e48">checkpoint_history_</a></td></tr>
<tr class="separator:adee37c93eff7a274e513b99cf03d0e48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee6091ea8e78617abbf407fe1bd4c5a8" id="r_aee6091ea8e78617abbf407fe1bd4c5a8"><td class="memItemLeft" align="right" valign="top">std::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsqlcc_1_1WALManager.html#aee6091ea8e78617abbf407fe1bd4c5a8">checkpoint_mutex_</a></td></tr>
<tr class="separator:aee6091ea8e78617abbf407fe1bd4c5a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>WAL（预写日志）管理器 - v0.4.8版本初始实现</p>
<p>核心功能：</p><ul>
<li>日志记录写入和读取</li>
<li>原子性确保 (Atomicity)</li>
<li>持久性确保 (Durability)</li>
<li>检查点机制</li>
<li>崩溃恢复支持</li>
</ul>
<p>设计原则：</p><ul>
<li>写前日志：数据修改前必须先写日志</li>
<li>顺序写：高性能顺序I/O</li>
<li>批量提交：减少I/O次数</li>
<li>异步刷盘：性能和一致性平衡 </li>
</ul>

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00091">91</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a986bb1e76ab0b52b35684aa023271e63" name="a986bb1e76ab0b52b35684aa023271e63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a986bb1e76ab0b52b35684aa023271e63">&#9670;&#160;</a></span>WALManager() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">sqlcc::WALManager::WALManager </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>log_file_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>force_sync</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>构造函数 </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">log_file_path</td><td>日志文件路径 </td></tr>
    <tr><td class="paramname">force_sync</td><td>是否强制同步写入 </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00080">80</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   81</span>    : <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ad29ce65e1ab00ed57e4d79c65a99e44a">log_file_path_</a>(log_file_path),</div>
<div class="line"><span class="lineno">   82</span>      <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ae73989908d2b65d7a9c7b671143c8db3">checkpoint_file_path_</a>(log_file_path + <span class="stringliteral">&quot;.chk&quot;</span>), <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ab66b3d926874bb5347f825e4c73f627b">next_lsn_</a>(1),</div>
<div class="line"><span class="lineno">   83</span>      <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a41b15908cf56904fb80a53040b4d0025">last_flushed_lsn_</a>(0), <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#aea56fc2bf3f9578154648a3f4ff033dc">last_checkpoint_lsn_</a>(0), <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a6cfa568f0b7af8a6635b714b55b9f557">force_sync_</a>(force_sync),</div>
<div class="line"><span class="lineno">   84</span>      <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ad91c54a36b39904be7e76f75ae7177a4">flush_interval_ms_</a>(100) { <span class="comment">// 100ms异步刷盘间隔</span></div>
<div class="line"><span class="lineno">   85</span> </div>
<div class="line"><span class="lineno">   86</span>  <span class="comment">// 初始化指标</span></div>
<div class="line"><span class="lineno">   87</span>  <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#ab0d735305d2a43b5bf2e58c47721c031">total_records</a> = 0;</div>
<div class="line"><span class="lineno">   88</span>  <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#a304ebf7b45e90302a862f67039498f27">flushed_records</a> = 0;</div>
<div class="line"><span class="lineno">   89</span>  <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#aa26c37bf0fb3f6e6ebb8e3149312520d">pending_records</a> = 0;</div>
<div class="line"><span class="lineno">   90</span>  <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#a1d72b0ea0c05244139fe400d841c05a7">total_checkpoints</a> = 0;</div>
<div class="line"><span class="lineno">   91</span>  <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#a71eafda08972237323dbc8e80ad8b830">log_file_size_bytes</a> = 0;</div>
<div class="line"><span class="lineno">   92</span> </div>
<div class="line"><span class="lineno">   93</span>  <span class="comment">// 初始化日志文件</span></div>
<div class="line"><span class="lineno">   94</span>  <a class="code hl_function" href="classsqlcc_1_1WALManager.html#a074d5c37e0a0d7b55a9abd1dee3b5680">InitializeLogFile</a>();</div>
<div class="line"><span class="lineno">   95</span> </div>
<div class="line"><span class="lineno">   96</span>  <span class="comment">// 暂时禁用异步刷盘功能以解决编译问题</span></div>
<div class="line"><span class="lineno">   97</span>  <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a6cfa568f0b7af8a6635b714b55b9f557">force_sync_</a> = <span class="keyword">true</span>; <span class="comment">// 强制使用同步模式</span></div>
<div class="line"><span class="lineno">   98</span>  <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a58f40b4c377e50777666692517c16fb3">stop_flush_thread_</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">   99</span> </div>
<div class="line"><span class="lineno">  100</span>  std::cout &lt;&lt; <span class="stringliteral">&quot;WALManager 已初始化 - 日志文件: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ad29ce65e1ab00ed57e4d79c65a99e44a">log_file_path_</a></div>
<div class="line"><span class="lineno">  101</span>            &lt;&lt; <span class="stringliteral">&quot; 强制同步: &quot;</span> &lt;&lt; (<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a6cfa568f0b7af8a6635b714b55b9f557">force_sync_</a> ? <span class="stringliteral">&quot;是&quot;</span> : <span class="stringliteral">&quot;否&quot;</span>) &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  102</span>}</div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_a074d5c37e0a0d7b55a9abd1dee3b5680"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#a074d5c37e0a0d7b55a9abd1dee3b5680">sqlcc::WALManager::InitializeLogFile</a></div><div class="ttdeci">void InitializeLogFile()</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8cpp_source.html#l00446">wal_manager.cpp:446</a></div></div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_a41b15908cf56904fb80a53040b4d0025"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#a41b15908cf56904fb80a53040b4d0025">sqlcc::WALManager::last_flushed_lsn_</a></div><div class="ttdeci">std::atomic&lt; uint64_t &gt; last_flushed_lsn_</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00282">wal_manager.h:282</a></div></div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_a58f40b4c377e50777666692517c16fb3"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#a58f40b4c377e50777666692517c16fb3">sqlcc::WALManager::stop_flush_thread_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; stop_flush_thread_</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00292">wal_manager.h:292</a></div></div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_a6cfa568f0b7af8a6635b714b55b9f557"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#a6cfa568f0b7af8a6635b714b55b9f557">sqlcc::WALManager::force_sync_</a></div><div class="ttdeci">bool force_sync_</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00294">wal_manager.h:294</a></div></div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_a887731813def7012ce73bad9c6940e4d"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">sqlcc::WALManager::metrics_</a></div><div class="ttdeci">WALMetrics metrics_</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00299">wal_manager.h:299</a></div></div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_ab66b3d926874bb5347f825e4c73f627b"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#ab66b3d926874bb5347f825e4c73f627b">sqlcc::WALManager::next_lsn_</a></div><div class="ttdeci">std::atomic&lt; uint64_t &gt; next_lsn_</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00281">wal_manager.h:281</a></div></div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_ad29ce65e1ab00ed57e4d79c65a99e44a"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#ad29ce65e1ab00ed57e4d79c65a99e44a">sqlcc::WALManager::log_file_path_</a></div><div class="ttdeci">std::string log_file_path_</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00278">wal_manager.h:278</a></div></div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_ad91c54a36b39904be7e76f75ae7177a4"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#ad91c54a36b39904be7e76f75ae7177a4">sqlcc::WALManager::flush_interval_ms_</a></div><div class="ttdeci">uint32_t flush_interval_ms_</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00295">wal_manager.h:295</a></div></div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_ae73989908d2b65d7a9c7b671143c8db3"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#ae73989908d2b65d7a9c7b671143c8db3">sqlcc::WALManager::checkpoint_file_path_</a></div><div class="ttdeci">std::string checkpoint_file_path_</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00279">wal_manager.h:279</a></div></div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_aea56fc2bf3f9578154648a3f4ff033dc"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#aea56fc2bf3f9578154648a3f4ff033dc">sqlcc::WALManager::last_checkpoint_lsn_</a></div><div class="ttdeci">std::atomic&lt; uint64_t &gt; last_checkpoint_lsn_</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00283">wal_manager.h:283</a></div></div>
<div class="ttc" id="astructsqlcc_1_1WALManager_1_1WALMetrics_html_a1d72b0ea0c05244139fe400d841c05a7"><div class="ttname"><a href="structsqlcc_1_1WALManager_1_1WALMetrics.html#a1d72b0ea0c05244139fe400d841c05a7">sqlcc::WALManager::WALMetrics::total_checkpoints</a></div><div class="ttdeci">size_t total_checkpoints</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00201">wal_manager.h:201</a></div></div>
<div class="ttc" id="astructsqlcc_1_1WALManager_1_1WALMetrics_html_a304ebf7b45e90302a862f67039498f27"><div class="ttname"><a href="structsqlcc_1_1WALManager_1_1WALMetrics.html#a304ebf7b45e90302a862f67039498f27">sqlcc::WALManager::WALMetrics::flushed_records</a></div><div class="ttdeci">size_t flushed_records</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00197">wal_manager.h:197</a></div></div>
<div class="ttc" id="astructsqlcc_1_1WALManager_1_1WALMetrics_html_a71eafda08972237323dbc8e80ad8b830"><div class="ttname"><a href="structsqlcc_1_1WALManager_1_1WALMetrics.html#a71eafda08972237323dbc8e80ad8b830">sqlcc::WALManager::WALMetrics::log_file_size_bytes</a></div><div class="ttdeci">size_t log_file_size_bytes</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00202">wal_manager.h:202</a></div></div>
<div class="ttc" id="astructsqlcc_1_1WALManager_1_1WALMetrics_html_aa26c37bf0fb3f6e6ebb8e3149312520d"><div class="ttname"><a href="structsqlcc_1_1WALManager_1_1WALMetrics.html#aa26c37bf0fb3f6e6ebb8e3149312520d">sqlcc::WALManager::WALMetrics::pending_records</a></div><div class="ttdeci">size_t pending_records</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00198">wal_manager.h:198</a></div></div>
<div class="ttc" id="astructsqlcc_1_1WALManager_1_1WALMetrics_html_ab0d735305d2a43b5bf2e58c47721c031"><div class="ttname"><a href="structsqlcc_1_1WALManager_1_1WALMetrics.html#ab0d735305d2a43b5bf2e58c47721c031">sqlcc::WALManager::WALMetrics::total_records</a></div><div class="ttdeci">size_t total_records</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00196">wal_manager.h:196</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8h_source.html#l00197">sqlcc::WALManager::WALMetrics::flushed_records</a>, <a class="el" href="wal__manager_8h_source.html#l00294">force_sync_</a>, <a class="el" href="wal__manager_8cpp_source.html#l00446">InitializeLogFile()</a>, <a class="el" href="wal__manager_8h_source.html#l00278">log_file_path_</a>, <a class="el" href="wal__manager_8h_source.html#l00202">sqlcc::WALManager::WALMetrics::log_file_size_bytes</a>, <a class="el" href="wal__manager_8h_source.html#l00299">metrics_</a>, <a class="el" href="wal__manager_8h_source.html#l00198">sqlcc::WALManager::WALMetrics::pending_records</a>, <a class="el" href="wal__manager_8h_source.html#l00292">stop_flush_thread_</a>, <a class="el" href="wal__manager_8h_source.html#l00201">sqlcc::WALManager::WALMetrics::total_checkpoints</a>, and <a class="el" href="wal__manager_8h_source.html#l00196">sqlcc::WALManager::WALMetrics::total_records</a>.</p>

</div>
</div>
<a id="a62deaec0e1a59a5da9f2953d1f96854e" name="a62deaec0e1a59a5da9f2953d1f96854e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62deaec0e1a59a5da9f2953d1f96854e">&#9670;&#160;</a></span>~WALManager()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sqlcc::WALManager::~WALManager </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>析构函数 - 确保所有日志都刷盘 </p>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00104">104</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  104</span>                        {</div>
<div class="line"><span class="lineno">  105</span>  <span class="comment">// 异步刷盘功能已被禁用</span></div>
<div class="line"><span class="lineno">  106</span>  <span class="comment">// 此处无需处理线程停止</span></div>
<div class="line"><span class="lineno">  107</span> </div>
<div class="line"><span class="lineno">  108</span>  <span class="comment">// 强制刷盘所有待写入日志</span></div>
<div class="line"><span class="lineno">  109</span>  <a class="code hl_function" href="classsqlcc_1_1WALManager.html#a2182448d5fe30eab8a1edb19ea4ac7c2">ForceFlush</a>();</div>
<div class="line"><span class="lineno">  110</span> </div>
<div class="line"><span class="lineno">  111</span>  std::cout &lt;&lt; <span class="stringliteral">&quot;WALManager 已销毁，所有日志已刷盘&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  112</span>}</div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_a2182448d5fe30eab8a1edb19ea4ac7c2"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#a2182448d5fe30eab8a1edb19ea4ac7c2">sqlcc::WALManager::ForceFlush</a></div><div class="ttdeci">void ForceFlush()</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8cpp_source.html#l00172">wal_manager.cpp:172</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8cpp_source.html#l00172">ForceFlush()</a>.</p>

</div>
</div>
<a id="a0379f4c4b5f2a79ae5305ea234c85300" name="a0379f4c4b5f2a79ae5305ea234c85300"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0379f4c4b5f2a79ae5305ea234c85300">&#9670;&#160;</a></span>WALManager() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">sqlcc::WALManager::WALManager </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classsqlcc_1_1WALManager.html">WALManager</a> &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a1720a736a0404f67c27eae5027a37ee5" name="a1720a736a0404f67c27eae5027a37ee5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1720a736a0404f67c27eae5027a37ee5">&#9670;&#160;</a></span>AnalyzeLog()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::unordered_map&lt; std::string, std::string &gt; sqlcc::WALManager::AnalyzeLog </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>分析日志文件状态 </p><dl class="section return"><dt>Returns</dt><dd>状态信息 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00247">247</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  247</span>                                                                    {</div>
<div class="line"><span class="lineno">  248</span>  std::unordered_map&lt;std::string, std::string&gt; recovery_actions;</div>
<div class="line"><span class="lineno">  249</span> </div>
<div class="line"><span class="lineno">  250</span>  <span class="comment">// 临时注释掉会导致编译错误的部分</span></div>
<div class="line"><span class="lineno">  251</span>  <span class="comment">// std::unique_lock&lt;std::mutex&gt; lock(buffer_mutex_);</span></div>
<div class="line"><span class="lineno">  252</span> </div>
<div class="line"><span class="lineno">  253</span>  <span class="comment">// TODO: 实现日志分析逻辑</span></div>
<div class="line"><span class="lineno">  254</span> </div>
<div class="line"><span class="lineno">  255</span>  (void)recovery_actions; <span class="comment">// 避免未使用变量警告</span></div>
<div class="line"><span class="lineno">  256</span>  <span class="keywordflow">return</span> {};</div>
<div class="line"><span class="lineno">  257</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a570b367959d33641bf78e78ed080abc4" name="a570b367959d33641bf78e78ed080abc4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a570b367959d33641bf78e78ed080abc4">&#9670;&#160;</a></span>AsyncFlush()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sqlcc::WALManager::AsyncFlush </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>异步刷盘（后台线程） </p>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00217">217</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  217</span>                            {</div>
<div class="line"><span class="lineno">  218</span>  <span class="comment">// 这里的实现是让异步刷盘线程立即执行一次刷盘</span></div>
<div class="line"><span class="lineno">  219</span>  {</div>
<div class="line"><span class="lineno">  220</span>    std::unique_lock&lt;std::mutex&gt; lock(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a584e5bde2e635c8f4ae2891b4931f306">buffer_mutex_</a>);</div>
<div class="line"><span class="lineno">  221</span>    <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a19894317c8741ac6fc0f8b786ee58774">buffer_cv_</a>.notify_one(); <span class="comment">// 唤醒异步刷盘线程执行刷盘</span></div>
<div class="line"><span class="lineno">  222</span>  }</div>
<div class="line"><span class="lineno">  223</span>}</div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_a19894317c8741ac6fc0f8b786ee58774"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#a19894317c8741ac6fc0f8b786ee58774">sqlcc::WALManager::buffer_cv_</a></div><div class="ttdeci">std::condition_variable buffer_cv_</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00288">wal_manager.h:288</a></div></div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_a584e5bde2e635c8f4ae2891b4931f306"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#a584e5bde2e635c8f4ae2891b4931f306">sqlcc::WALManager::buffer_mutex_</a></div><div class="ttdeci">std::mutex buffer_mutex_</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00287">wal_manager.h:287</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8h_source.html#l00288">buffer_cv_</a>, and <a class="el" href="wal__manager_8h_source.html#l00287">buffer_mutex_</a>.</p>

</div>
</div>
<a id="a590724cc46a80d7e002f10abdf6d5679" name="a590724cc46a80d7e002f10abdf6d5679"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a590724cc46a80d7e002f10abdf6d5679">&#9670;&#160;</a></span>AsyncFlushThread()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void sqlcc::WALManager::AsyncFlushThread </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>异步刷盘线程函数 </p>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00579">579</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  579</span>                                  {</div>
<div class="line"><span class="lineno">  580</span>  <span class="keywordflow">while</span> (!<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a58f40b4c377e50777666692517c16fb3">stop_flush_thread_</a>) {</div>
<div class="line"><span class="lineno">  581</span>    <span class="comment">// 检查是否有待刷盘的记录</span></div>
<div class="line"><span class="lineno">  582</span>    {</div>
<div class="line"><span class="lineno">  583</span>      std::unique_lock&lt;std::mutex&gt; lock(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a584e5bde2e635c8f4ae2891b4931f306">buffer_mutex_</a>);</div>
<div class="line"><span class="lineno">  584</span>      <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a19894317c8741ac6fc0f8b786ee58774">buffer_cv_</a>.wait_for(</div>
<div class="line"><span class="lineno">  585</span>          lock, std::chrono::milliseconds(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ad91c54a36b39904be7e76f75ae7177a4">flush_interval_ms_</a>),</div>
<div class="line"><span class="lineno">  586</span>          [<span class="keyword">this</span>]() { <span class="keywordflow">return</span> !<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a70af2e5f3016d1d2470f18e9c0077897">log_buffer_</a>.empty() || <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a58f40b4c377e50777666692517c16fb3">stop_flush_thread_</a>; });</div>
<div class="line"><span class="lineno">  587</span>    }</div>
<div class="line"><span class="lineno">  588</span> </div>
<div class="line"><span class="lineno">  589</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a58f40b4c377e50777666692517c16fb3">stop_flush_thread_</a>) {</div>
<div class="line"><span class="lineno">  590</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  591</span>    }</div>
<div class="line"><span class="lineno">  592</span> </div>
<div class="line"><span class="lineno">  593</span>    <span class="comment">// 执行异步刷盘</span></div>
<div class="line"><span class="lineno">  594</span>    <a class="code hl_function" href="classsqlcc_1_1WALManager.html#a2182448d5fe30eab8a1edb19ea4ac7c2">ForceFlush</a>();</div>
<div class="line"><span class="lineno">  595</span>  }</div>
<div class="line"><span class="lineno">  596</span> </div>
<div class="line"><span class="lineno">  597</span>  std::cout &lt;&lt; <span class="stringliteral">&quot;异步刷盘线程已停止&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  598</span>}</div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_a70af2e5f3016d1d2470f18e9c0077897"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#a70af2e5f3016d1d2470f18e9c0077897">sqlcc::WALManager::log_buffer_</a></div><div class="ttdeci">std::vector&lt; LogRecord &gt; log_buffer_</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00286">wal_manager.h:286</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8h_source.html#l00288">buffer_cv_</a>, <a class="el" href="wal__manager_8h_source.html#l00287">buffer_mutex_</a>, <a class="el" href="wal__manager_8h_source.html#l00295">flush_interval_ms_</a>, <a class="el" href="wal__manager_8cpp_source.html#l00172">ForceFlush()</a>, <a class="el" href="wal__manager_8h_source.html#l00286">log_buffer_</a>, and <a class="el" href="wal__manager_8h_source.html#l00292">stop_flush_thread_</a>.</p>

</div>
</div>
<a id="a0ef484e2e52bc4b154a977fb4c1bba8e" name="a0ef484e2e52bc4b154a977fb4c1bba8e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ef484e2e52bc4b154a977fb4c1bba8e">&#9670;&#160;</a></span>CompactLog()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t sqlcc::WALManager::CompactLog </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>keep_lsn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>整理日志文件（移除不必要的旧日志） </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">keep_lsn</td><td>需要保持的最小LSN </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>被清理的日志大小（字节） </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00428">428</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  428</span>                                               {</div>
<div class="line"><span class="lineno">  429</span>  <span class="comment">// 简化实现：记录需要保留的LSN，实际的日志压缩比较复杂</span></div>
<div class="line"><span class="lineno">  430</span>  <span class="comment">// 需要考虑并发控制、检查点等因素</span></div>
<div class="line"><span class="lineno">  431</span> </div>
<div class="line"><span class="lineno">  432</span>  std::cout &lt;&lt; <span class="stringliteral">&quot;日志整理完成（简化实现），保留LSN &gt;= &quot;</span> &lt;&lt; keep_lsn &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  433</span>  <span class="keywordflow">return</span> 0; <span class="comment">// 未实际压缩</span></div>
<div class="line"><span class="lineno">  434</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a07e24136b76e8844bac420b4b156f84a" name="a07e24136b76e8844bac420b4b156f84a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07e24136b76e8844bac420b4b156f84a">&#9670;&#160;</a></span>CreateCheckpoint()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t sqlcc::WALManager::CreateCheckpoint </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>sync</em> = <code>true</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>创建检查点 </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sync</td><td>是否同步写入 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>检查点LSN </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00259">259</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  259</span>                                               {</div>
<div class="line"><span class="lineno">  260</span>  <span class="comment">// 强制刷盘所有待写的记录</span></div>
<div class="line"><span class="lineno">  261</span>  <a class="code hl_function" href="classsqlcc_1_1WALManager.html#a2182448d5fe30eab8a1edb19ea4ac7c2">ForceFlush</a>();</div>
<div class="line"><span class="lineno">  262</span> </div>
<div class="line"><span class="lineno">  263</span>  uint64_t checkpoint_lsn = <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a41b15908cf56904fb80a53040b4d0025">last_flushed_lsn_</a>;</div>
<div class="line"><span class="lineno">  264</span> </div>
<div class="line"><span class="lineno">  265</span>  CheckpointState checkpoint{</div>
<div class="line"><span class="lineno">  266</span>      checkpoint_lsn,</div>
<div class="line"><span class="lineno">  267</span>      std::chrono::system_clock::now(),</div>
<div class="line"><span class="lineno">  268</span>      {} <span class="comment">// TODO: 获取当前页面状态快照</span></div>
<div class="line"><span class="lineno">  269</span>  };</div>
<div class="line"><span class="lineno">  270</span> </div>
<div class="line"><span class="lineno">  271</span>  <span class="comment">// 写入检查点到磁盘</span></div>
<div class="line"><span class="lineno">  272</span>  <span class="keywordflow">if</span> (sync) {</div>
<div class="line"><span class="lineno">  273</span>    <a class="code hl_function" href="classsqlcc_1_1WALManager.html#ac381c367099dca75a6ea373c963c8154">WriteCheckpointToDisk</a>(checkpoint);</div>
<div class="line"><span class="lineno">  274</span>  }</div>
<div class="line"><span class="lineno">  275</span> </div>
<div class="line"><span class="lineno">  276</span>  <span class="comment">// 更新检查点历史</span></div>
<div class="line"><span class="lineno">  277</span>  {</div>
<div class="line"><span class="lineno">  278</span>    std::unique_lock&lt;std::mutex&gt; lock(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#aee6091ea8e78617abbf407fe1bd4c5a8">checkpoint_mutex_</a>);</div>
<div class="line"><span class="lineno">  279</span>    <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#adee37c93eff7a274e513b99cf03d0e48">checkpoint_history_</a>.push_back(checkpoint);</div>
<div class="line"><span class="lineno">  280</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#adee37c93eff7a274e513b99cf03d0e48">checkpoint_history_</a>.size() &gt; 100) { <span class="comment">// 保留最近100个检查点</span></div>
<div class="line"><span class="lineno">  281</span>      <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#adee37c93eff7a274e513b99cf03d0e48">checkpoint_history_</a>.erase(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#adee37c93eff7a274e513b99cf03d0e48">checkpoint_history_</a>.begin());</div>
<div class="line"><span class="lineno">  282</span>    }</div>
<div class="line"><span class="lineno">  283</span>  }</div>
<div class="line"><span class="lineno">  284</span> </div>
<div class="line"><span class="lineno">  285</span>  <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#aea56fc2bf3f9578154648a3f4ff033dc">last_checkpoint_lsn_</a> = checkpoint_lsn;</div>
<div class="line"><span class="lineno">  286</span> </div>
<div class="line"><span class="lineno">  287</span>  <span class="comment">// 更新指标</span></div>
<div class="line"><span class="lineno">  288</span>  {</div>
<div class="line"><span class="lineno">  289</span>    std::unique_lock&lt;std::mutex&gt; lock(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ab2499798b907264408950dc8889ee785">metrics_mutex_</a>);</div>
<div class="line"><span class="lineno">  290</span>    <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#a1d72b0ea0c05244139fe400d841c05a7">total_checkpoints</a>++;</div>
<div class="line"><span class="lineno">  291</span>  }</div>
<div class="line"><span class="lineno">  292</span> </div>
<div class="line"><span class="lineno">  293</span>  std::cout &lt;&lt; <span class="stringliteral">&quot;已创建检查点，LSN: &quot;</span> &lt;&lt; checkpoint_lsn</div>
<div class="line"><span class="lineno">  294</span>            &lt;&lt; <span class="stringliteral">&quot; 同步模式: &quot;</span> &lt;&lt; (sync ? <span class="stringliteral">&quot;是&quot;</span> : <span class="stringliteral">&quot;否&quot;</span>) &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  295</span> </div>
<div class="line"><span class="lineno">  296</span>  <span class="keywordflow">return</span> checkpoint_lsn;</div>
<div class="line"><span class="lineno">  297</span>}</div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_ab2499798b907264408950dc8889ee785"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#ab2499798b907264408950dc8889ee785">sqlcc::WALManager::metrics_mutex_</a></div><div class="ttdeci">std::mutex metrics_mutex_</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00298">wal_manager.h:298</a></div></div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_ac381c367099dca75a6ea373c963c8154"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#ac381c367099dca75a6ea373c963c8154">sqlcc::WALManager::WriteCheckpointToDisk</a></div><div class="ttdeci">void WriteCheckpointToDisk(const CheckpointState &amp;checkpoint)</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8cpp_source.html#l00527">wal_manager.cpp:527</a></div></div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_adee37c93eff7a274e513b99cf03d0e48"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#adee37c93eff7a274e513b99cf03d0e48">sqlcc::WALManager::checkpoint_history_</a></div><div class="ttdeci">std::vector&lt; CheckpointState &gt; checkpoint_history_</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00302">wal_manager.h:302</a></div></div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_aee6091ea8e78617abbf407fe1bd4c5a8"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#aee6091ea8e78617abbf407fe1bd4c5a8">sqlcc::WALManager::checkpoint_mutex_</a></div><div class="ttdeci">std::mutex checkpoint_mutex_</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00303">wal_manager.h:303</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8h_source.html#l00302">checkpoint_history_</a>, <a class="el" href="wal__manager_8h_source.html#l00303">checkpoint_mutex_</a>, <a class="el" href="wal__manager_8cpp_source.html#l00172">ForceFlush()</a>, <a class="el" href="wal__manager_8h_source.html#l00283">last_checkpoint_lsn_</a>, <a class="el" href="wal__manager_8h_source.html#l00282">last_flushed_lsn_</a>, <a class="el" href="wal__manager_8h_source.html#l00299">metrics_</a>, <a class="el" href="wal__manager_8h_source.html#l00298">metrics_mutex_</a>, <a class="el" href="wal__manager_8h_source.html#l00201">sqlcc::WALManager::WALMetrics::total_checkpoints</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00527">WriteCheckpointToDisk()</a>.</p>

</div>
</div>
<a id="a2182448d5fe30eab8a1edb19ea4ac7c2" name="a2182448d5fe30eab8a1edb19ea4ac7c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2182448d5fe30eab8a1edb19ea4ac7c2">&#9670;&#160;</a></span>ForceFlush()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sqlcc::WALManager::ForceFlush </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>强制刷盘所有待写入日志 </p>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00172">172</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  172</span>                            {</div>
<div class="line"><span class="lineno">  173</span>  std::vector&lt;LogRecord&gt; records_to_flush;</div>
<div class="line"><span class="lineno">  174</span> </div>
<div class="line"><span class="lineno">  175</span>  <span class="comment">// 获取待刷盘的记录</span></div>
<div class="line"><span class="lineno">  176</span>  {</div>
<div class="line"><span class="lineno">  177</span>    std::unique_lock&lt;std::mutex&gt; lock(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a584e5bde2e635c8f4ae2891b4931f306">buffer_mutex_</a>);</div>
<div class="line"><span class="lineno">  178</span>    records_to_flush.swap(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a70af2e5f3016d1d2470f18e9c0077897">log_buffer_</a>);</div>
<div class="line"><span class="lineno">  179</span>  }</div>
<div class="line"><span class="lineno">  180</span> </div>
<div class="line"><span class="lineno">  181</span>  <span class="keywordflow">if</span> (records_to_flush.empty()) {</div>
<div class="line"><span class="lineno">  182</span>    <span class="keywordflow">return</span>; <span class="comment">// 没有待刷盘的记录</span></div>
<div class="line"><span class="lineno">  183</span>  }</div>
<div class="line"><span class="lineno">  184</span> </div>
<div class="line"><span class="lineno">  185</span>  <span class="comment">// 记录刷盘开始时间</span></div>
<div class="line"><span class="lineno">  186</span>  <span class="keyword">auto</span> start_time = std::chrono::high_resolution_clock::now();</div>
<div class="line"><span class="lineno">  187</span> </div>
<div class="line"><span class="lineno">  188</span>  <span class="comment">// 写入到磁盘</span></div>
<div class="line"><span class="lineno">  189</span>  <span class="keywordtype">size_t</span> written_count = <a class="code hl_function" href="classsqlcc_1_1WALManager.html#a7fad927d4160a13c505e6266523bc21f">WriteRecordsToDisk</a>(records_to_flush);</div>
<div class="line"><span class="lineno">  190</span> </div>
<div class="line"><span class="lineno">  191</span>  <span class="comment">// 记录刷盘结束时间并更新性能指标</span></div>
<div class="line"><span class="lineno">  192</span>  <span class="keyword">auto</span> end_time = std::chrono::high_resolution_clock::now();</div>
<div class="line"><span class="lineno">  193</span>  <span class="keyword">auto</span> flush_time = std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(</div>
<div class="line"><span class="lineno">  194</span>      end_time - start_time);</div>
<div class="line"><span class="lineno">  195</span> </div>
<div class="line"><span class="lineno">  196</span>  {</div>
<div class="line"><span class="lineno">  197</span>    std::unique_lock&lt;std::mutex&gt; lock(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ab2499798b907264408950dc8889ee785">metrics_mutex_</a>);</div>
<div class="line"><span class="lineno">  198</span>    <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#a304ebf7b45e90302a862f67039498f27">flushed_records</a> += written_count;</div>
<div class="line"><span class="lineno">  199</span>    <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#aa26c37bf0fb3f6e6ebb8e3149312520d">pending_records</a> -= written_count;</div>
<div class="line"><span class="lineno">  200</span>    <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#aaac22d03003ab01e5af7b4c05de463f7">total_flush_time</a> += flush_time;</div>
<div class="line"><span class="lineno">  201</span> </div>
<div class="line"><span class="lineno">  202</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#a304ebf7b45e90302a862f67039498f27">flushed_records</a> &gt; 0) {</div>
<div class="line"><span class="lineno">  203</span>      <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#ae0717d71ba9de27672a9efde0eafbc9f">avg_flush_time</a> = std::chrono::microseconds(</div>
<div class="line"><span class="lineno">  204</span>          <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#aaac22d03003ab01e5af7b4c05de463f7">total_flush_time</a>.count() / <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#a304ebf7b45e90302a862f67039498f27">flushed_records</a>);</div>
<div class="line"><span class="lineno">  205</span>    }</div>
<div class="line"><span class="lineno">  206</span>  }</div>
<div class="line"><span class="lineno">  207</span> </div>
<div class="line"><span class="lineno">  208</span>  <span class="comment">// 更新最后刷盘LSN</span></div>
<div class="line"><span class="lineno">  209</span>  <span class="keywordflow">if</span> (!records_to_flush.empty()) {</div>
<div class="line"><span class="lineno">  210</span>    <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a41b15908cf56904fb80a53040b4d0025">last_flushed_lsn_</a> = records_to_flush.back().lsn;</div>
<div class="line"><span class="lineno">  211</span>  }</div>
<div class="line"><span class="lineno">  212</span> </div>
<div class="line"><span class="lineno">  213</span>  std::cout &lt;&lt; <span class="stringliteral">&quot;已强制刷盘 &quot;</span> &lt;&lt; written_count &lt;&lt; <span class="stringliteral">&quot; 条日志记录，用时 &quot;</span></div>
<div class="line"><span class="lineno">  214</span>            &lt;&lt; flush_time.count() &lt;&lt; <span class="stringliteral">&quot; 微秒&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  215</span>}</div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_a7fad927d4160a13c505e6266523bc21f"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#a7fad927d4160a13c505e6266523bc21f">sqlcc::WALManager::WriteRecordsToDisk</a></div><div class="ttdeci">size_t WriteRecordsToDisk(const std::vector&lt; LogRecord &gt; &amp;records)</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8cpp_source.html#l00479">wal_manager.cpp:479</a></div></div>
<div class="ttc" id="astructsqlcc_1_1WALManager_1_1WALMetrics_html_aaac22d03003ab01e5af7b4c05de463f7"><div class="ttname"><a href="structsqlcc_1_1WALManager_1_1WALMetrics.html#aaac22d03003ab01e5af7b4c05de463f7">sqlcc::WALManager::WALMetrics::total_flush_time</a></div><div class="ttdeci">std::chrono::microseconds total_flush_time</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00200">wal_manager.h:200</a></div></div>
<div class="ttc" id="astructsqlcc_1_1WALManager_1_1WALMetrics_html_ae0717d71ba9de27672a9efde0eafbc9f"><div class="ttname"><a href="structsqlcc_1_1WALManager_1_1WALMetrics.html#ae0717d71ba9de27672a9efde0eafbc9f">sqlcc::WALManager::WALMetrics::avg_flush_time</a></div><div class="ttdeci">std::chrono::microseconds avg_flush_time</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8h_source.html#l00199">wal_manager.h:199</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8h_source.html#l00199">sqlcc::WALManager::WALMetrics::avg_flush_time</a>, <a class="el" href="wal__manager_8h_source.html#l00287">buffer_mutex_</a>, <a class="el" href="wal__manager_8h_source.html#l00197">sqlcc::WALManager::WALMetrics::flushed_records</a>, <a class="el" href="wal__manager_8h_source.html#l00282">last_flushed_lsn_</a>, <a class="el" href="wal__manager_8h_source.html#l00286">log_buffer_</a>, <a class="el" href="wal__manager_8h_source.html#l00299">metrics_</a>, <a class="el" href="wal__manager_8h_source.html#l00298">metrics_mutex_</a>, <a class="el" href="wal__manager_8h_source.html#l00198">sqlcc::WALManager::WALMetrics::pending_records</a>, <a class="el" href="wal__manager_8h_source.html#l00200">sqlcc::WALManager::WALMetrics::total_flush_time</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00479">WriteRecordsToDisk()</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00579">AsyncFlushThread()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00259">CreateCheckpoint()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00114">Log()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00142">LogBatch()</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00104">~WALManager()</a>.</p>

</div>
</div>
<a id="a38c8b378145939d8285b19cbf556933a" name="a38c8b378145939d8285b19cbf556933a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38c8b378145939d8285b19cbf556933a">&#9670;&#160;</a></span>GenerateLSN()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t sqlcc::WALManager::GenerateLSN </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>生成新的LSN </p><dl class="section return"><dt>Returns</dt><dd>新的LSN </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00475">475</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  475</span>                                 {</div>
<div class="line"><span class="lineno">  476</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ab66b3d926874bb5347f825e4c73f627b">next_lsn_</a>.fetch_add(1, std::memory_order_relaxed);</div>
<div class="line"><span class="lineno">  477</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8h_source.html#l00281">next_lsn_</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00114">Log()</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00142">LogBatch()</a>.</p>

</div>
</div>
<a id="a95788376c9417f992faa13a362166d4e" name="a95788376c9417f992faa13a362166d4e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95788376c9417f992faa13a362166d4e">&#9670;&#160;</a></span>GetCheckpointHistory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="structsqlcc_1_1CheckpointState.html">CheckpointState</a> &gt; sqlcc::WALManager::GetCheckpointHistory </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>获取检查点历史 </p><dl class="section return"><dt>Returns</dt><dd>检查点列表（按时间排序） </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00303">303</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  303</span>                                                                  {</div>
<div class="line"><span class="lineno">  304</span>  std::unique_lock&lt;std::mutex&gt; lock(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#aee6091ea8e78617abbf407fe1bd4c5a8">checkpoint_mutex_</a>);</div>
<div class="line"><span class="lineno">  305</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#adee37c93eff7a274e513b99cf03d0e48">checkpoint_history_</a>;</div>
<div class="line"><span class="lineno">  306</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8h_source.html#l00302">checkpoint_history_</a>, and <a class="el" href="wal__manager_8h_source.html#l00303">checkpoint_mutex_</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00299">GetLastCheckpoint()</a>.</p>

</div>
</div>
<a id="a091dca265b65e1f5e39982209f4c4b15" name="a091dca265b65e1f5e39982209f4c4b15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a091dca265b65e1f5e39982209f4c4b15">&#9670;&#160;</a></span>GetInProgressTransactions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="namespacesqlcc.html#a39e312beb85ecaf1f79763e7ce9d1b22">TransactionId</a> &gt; sqlcc::WALManager::GetInProgressTransactions </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>获取正在进行事务的ID列表 </p><dl class="section return"><dt>Returns</dt><dd>事务ID列表 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00359">359</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  359</span>                                                                     {</div>
<div class="line"><span class="lineno">  360</span>  std::vector&lt;TransactionId&gt; active_transactions;</div>
<div class="line"><span class="lineno">  361</span> </div>
<div class="line"><span class="lineno">  362</span>  <span class="comment">// 临时注释掉会导致编译错误的部分</span></div>
<div class="line"><span class="lineno">  363</span>  <span class="comment">// std::vector&lt;LogRecord&gt; recent_logs = ReadLogRange(last_checkpoint_lsn_ + 1,</span></div>
<div class="line"><span class="lineno">  364</span>  <span class="comment">// next_lsn_.load() - 1);</span></div>
<div class="line"><span class="lineno">  365</span> </div>
<div class="line"><span class="lineno">  366</span>  <span class="comment">// TODO: 实现获取进行中事务的逻辑</span></div>
<div class="line"><span class="lineno">  367</span> </div>
<div class="line"><span class="lineno">  368</span>  (void)active_transactions; <span class="comment">// 避免未使用变量警告</span></div>
<div class="line"><span class="lineno">  369</span>  <span class="keywordflow">return</span> {};</div>
<div class="line"><span class="lineno">  370</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a978a77f99e2ed7e461362508d691974c" name="a978a77f99e2ed7e461362508d691974c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a978a77f99e2ed7e461362508d691974c">&#9670;&#160;</a></span>GetLastCheckpoint()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsqlcc_1_1CheckpointState.html">CheckpointState</a> sqlcc::WALManager::GetLastCheckpoint </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>获取最后一个检查点状态 </p><dl class="section return"><dt>Returns</dt><dd>检查点状态 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00299">299</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  299</span>                                                    {</div>
<div class="line"><span class="lineno">  300</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="classsqlcc_1_1WALManager.html#a95788376c9417f992faa13a362166d4e">GetCheckpointHistory</a>().back();</div>
<div class="line"><span class="lineno">  301</span>}</div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_a95788376c9417f992faa13a362166d4e"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#a95788376c9417f992faa13a362166d4e">sqlcc::WALManager::GetCheckpointHistory</a></div><div class="ttdeci">std::vector&lt; CheckpointState &gt; GetCheckpointHistory() const</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8cpp_source.html#l00303">wal_manager.cpp:303</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8cpp_source.html#l00303">GetCheckpointHistory()</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00308">RecoverFromLog()</a>.</p>

</div>
</div>
<a id="aec3e8eed99b436afb135eb6f6f963fab" name="aec3e8eed99b436afb135eb6f6f963fab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec3e8eed99b436afb135eb6f6f963fab">&#9670;&#160;</a></span>GetMetrics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsqlcc_1_1WALManager_1_1WALMetrics.html">WALManager::WALMetrics</a> sqlcc::WALManager::GetMetrics </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>获取WAL性能指标 </p><dl class="section return"><dt>Returns</dt><dd>性能指标 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00406">406</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  406</span>                                                  {</div>
<div class="line"><span class="lineno">  407</span>  WALMetrics metrics;</div>
<div class="line"><span class="lineno">  408</span> </div>
<div class="line"><span class="lineno">  409</span>  <span class="comment">// 临时注释掉会导致编译错误的部分</span></div>
<div class="line"><span class="lineno">  410</span>  <span class="comment">// metrics.log_file_size_bytes = std::filesystem::file_size(log_file_path_);</span></div>
<div class="line"><span class="lineno">  411</span> </div>
<div class="line"><span class="lineno">  412</span>  <span class="comment">// std::unique_lock&lt;std::mutex&gt; buffer_lock(buffer_mutex_);</span></div>
<div class="line"><span class="lineno">  413</span>  <span class="comment">// metrics.pending_records = log_buffer_.size();</span></div>
<div class="line"><span class="lineno">  414</span> </div>
<div class="line"><span class="lineno">  415</span>  <span class="comment">// TODO: 实现指标收集逻辑</span></div>
<div class="line"><span class="lineno">  416</span> </div>
<div class="line"><span class="lineno">  417</span>  (void)metrics; <span class="comment">// 避免未使用变量警告</span></div>
<div class="line"><span class="lineno">  418</span>  <span class="keywordflow">return</span> {};</div>
<div class="line"><span class="lineno">  419</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a074d5c37e0a0d7b55a9abd1dee3b5680" name="a074d5c37e0a0d7b55a9abd1dee3b5680"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a074d5c37e0a0d7b55a9abd1dee3b5680">&#9670;&#160;</a></span>InitializeLogFile()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void sqlcc::WALManager::InitializeLogFile </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>初始化日志文件 </p>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00446">446</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  446</span>                                   {</div>
<div class="line"><span class="lineno">  447</span>  <span class="comment">// 确保日志目录存在</span></div>
<div class="line"><span class="lineno">  448</span>  std::filesystem::create_directories(</div>
<div class="line"><span class="lineno">  449</span>      std::filesystem::path(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ad29ce65e1ab00ed57e4d79c65a99e44a">log_file_path_</a>).parent_path());</div>
<div class="line"><span class="lineno">  450</span> </div>
<div class="line"><span class="lineno">  451</span>  <span class="comment">// 如果日志文件不存在，创建空文件</span></div>
<div class="line"><span class="lineno">  452</span>  <span class="keywordflow">if</span> (!std::filesystem::exists(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ad29ce65e1ab00ed57e4d79c65a99e44a">log_file_path_</a>)) {</div>
<div class="line"><span class="lineno">  453</span>    std::ofstream log_file(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ad29ce65e1ab00ed57e4d79c65a99e44a">log_file_path_</a>, std::ios::binary);</div>
<div class="line"><span class="lineno">  454</span>    <span class="keywordflow">if</span> (!log_file) {</div>
<div class="line"><span class="lineno">  455</span>      <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;无法创建日志文件: &quot;</span> + <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ad29ce65e1ab00ed57e4d79c65a99e44a">log_file_path_</a>);</div>
<div class="line"><span class="lineno">  456</span>    }</div>
<div class="line"><span class="lineno">  457</span>    <span class="comment">// 写入日志文件头信息</span></div>
<div class="line"><span class="lineno">  458</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *header = <span class="stringliteral">&quot;SQLCC WAL v0.4.8&quot;</span>;</div>
<div class="line"><span class="lineno">  459</span>    log_file.write(header, strlen(header));</div>
<div class="line"><span class="lineno">  460</span>    log_file.close();</div>
<div class="line"><span class="lineno">  461</span>  }</div>
<div class="line"><span class="lineno">  462</span> </div>
<div class="line"><span class="lineno">  463</span>  <span class="comment">// 如果检查点文件不存在，也创建</span></div>
<div class="line"><span class="lineno">  464</span>  <span class="keywordflow">if</span> (!std::filesystem::exists(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ae73989908d2b65d7a9c7b671143c8db3">checkpoint_file_path_</a>)) {</div>
<div class="line"><span class="lineno">  465</span>    std::ofstream chk_file(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ae73989908d2b65d7a9c7b671143c8db3">checkpoint_file_path_</a>, std::ios::binary);</div>
<div class="line"><span class="lineno">  466</span>    <span class="keywordflow">if</span> (!chk_file) {</div>
<div class="line"><span class="lineno">  467</span>      <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;无法创建检查点文件: &quot;</span> + <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ae73989908d2b65d7a9c7b671143c8db3">checkpoint_file_path_</a>);</div>
<div class="line"><span class="lineno">  468</span>    }</div>
<div class="line"><span class="lineno">  469</span>    chk_file.close();</div>
<div class="line"><span class="lineno">  470</span>  }</div>
<div class="line"><span class="lineno">  471</span> </div>
<div class="line"><span class="lineno">  472</span>  std::cout &lt;&lt; <span class="stringliteral">&quot;WAL日志文件已初始化: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ad29ce65e1ab00ed57e4d79c65a99e44a">log_file_path_</a> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  473</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8h_source.html#l00279">checkpoint_file_path_</a>, and <a class="el" href="wal__manager_8h_source.html#l00278">log_file_path_</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00080">WALManager()</a>.</p>

</div>
</div>
<a id="a8cd4656d2d3cbfe45e85829d8e4d4ba4" name="a8cd4656d2d3cbfe45e85829d8e4d4ba4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cd4656d2d3cbfe45e85829d8e4d4ba4">&#9670;&#160;</a></span>Log()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t sqlcc::WALManager::Log </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsqlcc_1_1LogRecord.html">LogRecord</a>&#160;</td>
          <td class="paramname"><em>record</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>写入日志记录 </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">record</td><td>要写入的日志记录 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>分配的LSN </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00114">114</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  114</span>                                         {</div>
<div class="line"><span class="lineno">  115</span>  <span class="comment">// 分配LSN</span></div>
<div class="line"><span class="lineno">  116</span>  uint64_t assigned_lsn = <a class="code hl_function" href="classsqlcc_1_1WALManager.html#a38c8b378145939d8285b19cbf556933a">GenerateLSN</a>();</div>
<div class="line"><span class="lineno">  117</span>  record.lsn = assigned_lsn;</div>
<div class="line"><span class="lineno">  118</span>  record.timestamp = std::chrono::system_clock::now();</div>
<div class="line"><span class="lineno">  119</span> </div>
<div class="line"><span class="lineno">  120</span>  <span class="comment">// 放入缓冲区</span></div>
<div class="line"><span class="lineno">  121</span>  {</div>
<div class="line"><span class="lineno">  122</span>    std::unique_lock&lt;std::mutex&gt; lock(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a584e5bde2e635c8f4ae2891b4931f306">buffer_mutex_</a>);</div>
<div class="line"><span class="lineno">  123</span>    <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a70af2e5f3016d1d2470f18e9c0077897">log_buffer_</a>.push_back(record);</div>
<div class="line"><span class="lineno">  124</span>    <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a19894317c8741ac6fc0f8b786ee58774">buffer_cv_</a>.notify_one(); <span class="comment">// 唤醒异步刷盘线程</span></div>
<div class="line"><span class="lineno">  125</span>  }</div>
<div class="line"><span class="lineno">  126</span> </div>
<div class="line"><span class="lineno">  127</span>  <span class="comment">// 更新指标</span></div>
<div class="line"><span class="lineno">  128</span>  {</div>
<div class="line"><span class="lineno">  129</span>    std::unique_lock&lt;std::mutex&gt; lock(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ab2499798b907264408950dc8889ee785">metrics_mutex_</a>);</div>
<div class="line"><span class="lineno">  130</span>    <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#ab0d735305d2a43b5bf2e58c47721c031">total_records</a>++;</div>
<div class="line"><span class="lineno">  131</span>    <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#aa26c37bf0fb3f6e6ebb8e3149312520d">pending_records</a>++;</div>
<div class="line"><span class="lineno">  132</span>  }</div>
<div class="line"><span class="lineno">  133</span> </div>
<div class="line"><span class="lineno">  134</span>  <span class="comment">// 如果是强制同步模式，立刻刷盘</span></div>
<div class="line"><span class="lineno">  135</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a6cfa568f0b7af8a6635b714b55b9f557">force_sync_</a>) {</div>
<div class="line"><span class="lineno">  136</span>    <a class="code hl_function" href="classsqlcc_1_1WALManager.html#a2182448d5fe30eab8a1edb19ea4ac7c2">ForceFlush</a>();</div>
<div class="line"><span class="lineno">  137</span>  }</div>
<div class="line"><span class="lineno">  138</span> </div>
<div class="line"><span class="lineno">  139</span>  <span class="keywordflow">return</span> assigned_lsn;</div>
<div class="line"><span class="lineno">  140</span>}</div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_a38c8b378145939d8285b19cbf556933a"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#a38c8b378145939d8285b19cbf556933a">sqlcc::WALManager::GenerateLSN</a></div><div class="ttdeci">uint64_t GenerateLSN()</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8cpp_source.html#l00475">wal_manager.cpp:475</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8h_source.html#l00288">buffer_cv_</a>, <a class="el" href="wal__manager_8h_source.html#l00287">buffer_mutex_</a>, <a class="el" href="wal__manager_8h_source.html#l00294">force_sync_</a>, <a class="el" href="wal__manager_8cpp_source.html#l00172">ForceFlush()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00475">GenerateLSN()</a>, <a class="el" href="wal__manager_8h_source.html#l00286">log_buffer_</a>, <a class="el" href="wal__manager_8h_source.html#l00058">sqlcc::LogRecord::lsn</a>, <a class="el" href="wal__manager_8h_source.html#l00299">metrics_</a>, <a class="el" href="wal__manager_8h_source.html#l00298">metrics_mutex_</a>, <a class="el" href="wal__manager_8h_source.html#l00198">sqlcc::WALManager::WALMetrics::pending_records</a>, <a class="el" href="wal__manager_8h_source.html#l00059">sqlcc::LogRecord::timestamp</a>, and <a class="el" href="wal__manager_8h_source.html#l00196">sqlcc::WALManager::WALMetrics::total_records</a>.</p>

</div>
</div>
<a id="aea741255621a6d0c4003ceddcb48b4bc" name="aea741255621a6d0c4003ceddcb48b4bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea741255621a6d0c4003ceddcb48b4bc">&#9670;&#160;</a></span>LogBatch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t sqlcc::WALManager::LogBatch </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structsqlcc_1_1LogRecord.html">LogRecord</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>records</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>批量写入日志记录 </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">records</td><td>日志记录列表 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>最后分配的LSN </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00142">142</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  142</span>                                                                 {</div>
<div class="line"><span class="lineno">  143</span>  uint64_t last_lsn = 0;</div>
<div class="line"><span class="lineno">  144</span> </div>
<div class="line"><span class="lineno">  145</span>  <span class="comment">// 为批量记录分配连续的LSN</span></div>
<div class="line"><span class="lineno">  146</span>  std::unique_lock&lt;std::mutex&gt; buffer_lock(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a584e5bde2e635c8f4ae2891b4931f306">buffer_mutex_</a>);</div>
<div class="line"><span class="lineno">  147</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> record : records) {</div>
<div class="line"><span class="lineno">  148</span>    uint64_t assigned_lsn = <a class="code hl_function" href="classsqlcc_1_1WALManager.html#a38c8b378145939d8285b19cbf556933a">GenerateLSN</a>();</div>
<div class="line"><span class="lineno">  149</span>    record.lsn = assigned_lsn;</div>
<div class="line"><span class="lineno">  150</span>    record.timestamp = std::chrono::system_clock::now();</div>
<div class="line"><span class="lineno">  151</span>    <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a70af2e5f3016d1d2470f18e9c0077897">log_buffer_</a>.push_back(record);</div>
<div class="line"><span class="lineno">  152</span>    last_lsn = assigned_lsn;</div>
<div class="line"><span class="lineno">  153</span>  }</div>
<div class="line"><span class="lineno">  154</span>  <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a19894317c8741ac6fc0f8b786ee58774">buffer_cv_</a>.notify_one();</div>
<div class="line"><span class="lineno">  155</span> </div>
<div class="line"><span class="lineno">  156</span>  <span class="comment">// 更新指标</span></div>
<div class="line"><span class="lineno">  157</span>  {</div>
<div class="line"><span class="lineno">  158</span>    std::unique_lock&lt;std::mutex&gt; lock(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ab2499798b907264408950dc8889ee785">metrics_mutex_</a>);</div>
<div class="line"><span class="lineno">  159</span>    <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#ab0d735305d2a43b5bf2e58c47721c031">total_records</a> += records.size();</div>
<div class="line"><span class="lineno">  160</span>    <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a>.<a class="code hl_variable" href="structsqlcc_1_1WALManager_1_1WALMetrics.html#aa26c37bf0fb3f6e6ebb8e3149312520d">pending_records</a> += records.size();</div>
<div class="line"><span class="lineno">  161</span>  }</div>
<div class="line"><span class="lineno">  162</span> </div>
<div class="line"><span class="lineno">  163</span>  <span class="comment">// 强制批提交</span></div>
<div class="line"><span class="lineno">  164</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a6cfa568f0b7af8a6635b714b55b9f557">force_sync_</a>) {</div>
<div class="line"><span class="lineno">  165</span>    buffer_lock.unlock();</div>
<div class="line"><span class="lineno">  166</span>    <a class="code hl_function" href="classsqlcc_1_1WALManager.html#a2182448d5fe30eab8a1edb19ea4ac7c2">ForceFlush</a>();</div>
<div class="line"><span class="lineno">  167</span>  }</div>
<div class="line"><span class="lineno">  168</span> </div>
<div class="line"><span class="lineno">  169</span>  <span class="keywordflow">return</span> last_lsn;</div>
<div class="line"><span class="lineno">  170</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8h_source.html#l00288">buffer_cv_</a>, <a class="el" href="wal__manager_8h_source.html#l00287">buffer_mutex_</a>, <a class="el" href="wal__manager_8h_source.html#l00294">force_sync_</a>, <a class="el" href="wal__manager_8cpp_source.html#l00172">ForceFlush()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00475">GenerateLSN()</a>, <a class="el" href="wal__manager_8h_source.html#l00286">log_buffer_</a>, <a class="el" href="wal__manager_8h_source.html#l00299">metrics_</a>, <a class="el" href="wal__manager_8h_source.html#l00298">metrics_mutex_</a>, <a class="el" href="wal__manager_8h_source.html#l00198">sqlcc::WALManager::WALMetrics::pending_records</a>, and <a class="el" href="wal__manager_8h_source.html#l00196">sqlcc::WALManager::WALMetrics::total_records</a>.</p>

</div>
</div>
<a id="a32be7c9eb54a8f234c2b928176abf524" name="a32be7c9eb54a8f234c2b928176abf524"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32be7c9eb54a8f234c2b928176abf524">&#9670;&#160;</a></span>operator=()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classsqlcc_1_1WALManager.html">WALManager</a> &amp; sqlcc::WALManager::operator= </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classsqlcc_1_1WALManager.html">WALManager</a> &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a9353abd74630d042dd207b4610ead150" name="a9353abd74630d042dd207b4610ead150"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9353abd74630d042dd207b4610ead150">&#9670;&#160;</a></span>ReadCheckpointFromDisk()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsqlcc_1_1CheckpointState.html">CheckpointState</a> sqlcc::WALManager::ReadCheckpointFromDisk </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>从磁盘读取检查点 </p><dl class="section return"><dt>Returns</dt><dd>检查点状态 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00549">549</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  549</span>                                                         {</div>
<div class="line"><span class="lineno">  550</span>  <span class="keywordflow">if</span> (!std::filesystem::exists(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ae73989908d2b65d7a9c7b671143c8db3">checkpoint_file_path_</a>)) {</div>
<div class="line"><span class="lineno">  551</span>    <span class="keywordflow">return</span> {0, std::chrono::system_clock::now(), {}}; <span class="comment">// 返回默认检查点</span></div>
<div class="line"><span class="lineno">  552</span>  }</div>
<div class="line"><span class="lineno">  553</span> </div>
<div class="line"><span class="lineno">  554</span>  std::ifstream chk_file(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ae73989908d2b65d7a9c7b671143c8db3">checkpoint_file_path_</a>, std::ios::binary);</div>
<div class="line"><span class="lineno">  555</span>  <span class="keywordflow">if</span> (!chk_file) {</div>
<div class="line"><span class="lineno">  556</span>    <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;无法打开检查点文件进行读取: &quot;</span> +</div>
<div class="line"><span class="lineno">  557</span>                             <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ae73989908d2b65d7a9c7b671143c8db3">checkpoint_file_path_</a>);</div>
<div class="line"><span class="lineno">  558</span>  }</div>
<div class="line"><span class="lineno">  559</span> </div>
<div class="line"><span class="lineno">  560</span>  CheckpointState checkpoint;</div>
<div class="line"><span class="lineno">  561</span> </div>
<div class="line"><span class="lineno">  562</span>  chk_file.read(<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(&amp;checkpoint.checkpoint_lsn),</div>
<div class="line"><span class="lineno">  563</span>                <span class="keyword">sizeof</span>(checkpoint.checkpoint_lsn));</div>
<div class="line"><span class="lineno">  564</span> </div>
<div class="line"><span class="lineno">  565</span>  std::chrono::system_clock::rep timestamp_count;</div>
<div class="line"><span class="lineno">  566</span>  chk_file.read(<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(&amp;timestamp_count),</div>
<div class="line"><span class="lineno">  567</span>                <span class="keyword">sizeof</span>(timestamp_count));</div>
<div class="line"><span class="lineno">  568</span> </div>
<div class="line"><span class="lineno">  569</span>  <span class="keywordflow">if</span> (!chk_file.fail()) {</div>
<div class="line"><span class="lineno">  570</span>    checkpoint.timestamp = std::chrono::system_clock::time_point(</div>
<div class="line"><span class="lineno">  571</span>        std::chrono::system_clock::duration(timestamp_count));</div>
<div class="line"><span class="lineno">  572</span>  }</div>
<div class="line"><span class="lineno">  573</span> </div>
<div class="line"><span class="lineno">  574</span>  <span class="comment">// TODO: 读取页面状态快照</span></div>
<div class="line"><span class="lineno">  575</span> </div>
<div class="line"><span class="lineno">  576</span>  <span class="keywordflow">return</span> checkpoint;</div>
<div class="line"><span class="lineno">  577</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8h_source.html#l00279">checkpoint_file_path_</a>, <a class="el" href="wal__manager_8h_source.html#l00070">sqlcc::CheckpointState::checkpoint_lsn</a>, and <a class="el" href="wal__manager_8h_source.html#l00071">sqlcc::CheckpointState::timestamp</a>.</p>

</div>
</div>
<a id="a113274a046fac18d8dfae2dd43518ff3" name="a113274a046fac18d8dfae2dd43518ff3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a113274a046fac18d8dfae2dd43518ff3">&#9670;&#160;</a></span>ReadLogRange()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="structsqlcc_1_1LogRecord.html">LogRecord</a> &gt; sqlcc::WALManager::ReadLogRange </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>from_lsn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>to_lsn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>读取指定范围的日志记录 </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">from_lsn</td><td>起始LSN </td></tr>
    <tr><td class="paramname">to_lsn</td><td>结束LSN </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>日志记录列表 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00225">225</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  226</span>                                                                 {</div>
<div class="line"><span class="lineno">  227</span>  std::vector&lt;LogRecord&gt; result;</div>
<div class="line"><span class="lineno">  228</span> </div>
<div class="line"><span class="lineno">  229</span>  <span class="comment">// 遍历LSN范围</span></div>
<div class="line"><span class="lineno">  230</span>  <span class="keywordflow">for</span> (uint64_t lsn = from_lsn; lsn &lt;= to_lsn; ++lsn) {</div>
<div class="line"><span class="lineno">  231</span>    <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  232</span>      LogRecord record = <a class="code hl_function" href="classsqlcc_1_1WALManager.html#ac9b839bfd1a04c5e1195263a16354662">ReadRecordFromDisk</a>(lsn);</div>
<div class="line"><span class="lineno">  233</span>      <span class="keywordflow">if</span> (record.lsn &gt; 0) { <span class="comment">// 检查记录是否存在</span></div>
<div class="line"><span class="lineno">  234</span>        result.push_back(record);</div>
<div class="line"><span class="lineno">  235</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  236</span>        <span class="keywordflow">break</span>; <span class="comment">// 没有更多记录</span></div>
<div class="line"><span class="lineno">  237</span>      }</div>
<div class="line"><span class="lineno">  238</span>    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;) {</div>
<div class="line"><span class="lineno">  239</span>      <span class="comment">// 记录不存在或损坏，跳过</span></div>
<div class="line"><span class="lineno">  240</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  241</span>    }</div>
<div class="line"><span class="lineno">  242</span>  }</div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span>  <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  245</span>}</div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_ac9b839bfd1a04c5e1195263a16354662"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#ac9b839bfd1a04c5e1195263a16354662">sqlcc::WALManager::ReadRecordFromDisk</a></div><div class="ttdeci">LogRecord ReadRecordFromDisk(uint64_t lsn)</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8cpp_source.html#l00519">wal_manager.cpp:519</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8h_source.html#l00058">sqlcc::LogRecord::lsn</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00519">ReadRecordFromDisk()</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00372">ReplayLog()</a>.</p>

</div>
</div>
<a id="ac9b839bfd1a04c5e1195263a16354662" name="ac9b839bfd1a04c5e1195263a16354662"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9b839bfd1a04c5e1195263a16354662">&#9670;&#160;</a></span>ReadRecordFromDisk()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsqlcc_1_1LogRecord.html">LogRecord</a> sqlcc::WALManager::ReadRecordFromDisk </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>lsn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>读取日志记录从磁盘 </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lsn</td><td>指定的LSN </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>日志记录 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00519">519</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  519</span>                                                     {</div>
<div class="line"><span class="lineno">  520</span>  <span class="comment">// 避免未使用参数警告</span></div>
<div class="line"><span class="lineno">  521</span>  (void)lsn;</div>
<div class="line"><span class="lineno">  522</span> </div>
<div class="line"><span class="lineno">  523</span>  <span class="comment">// TODO: 实现从磁盘读取记录的逻辑</span></div>
<div class="line"><span class="lineno">  524</span>  <span class="keywordflow">return</span> LogRecord();</div>
<div class="line"><span class="lineno">  525</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00225">ReadLogRange()</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00308">RecoverFromLog()</a>.</p>

</div>
</div>
<a id="a83952d3e6e769b49573f7484c2b1a8a5" name="a83952d3e6e769b49573f7484c2b1a8a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83952d3e6e769b49573f7484c2b1a8a5">&#9670;&#160;</a></span>RecoverFromLog()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sqlcc::WALManager::RecoverFromLog </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>从WAL执行崩溃恢复 </p><dl class="section return"><dt>Returns</dt><dd>是否恢复成功 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00308">308</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  308</span>                                {</div>
<div class="line"><span class="lineno">  309</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  310</span>    std::cout &lt;&lt; <span class="stringliteral">&quot;开始从WAL执行崩溃恢复...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  311</span> </div>
<div class="line"><span class="lineno">  312</span>    <span class="comment">// 1. 从最后一个检查点开始</span></div>
<div class="line"><span class="lineno">  313</span>    CheckpointState last_checkpoint = <a class="code hl_function" href="classsqlcc_1_1WALManager.html#a978a77f99e2ed7e461362508d691974c">GetLastCheckpoint</a>();</div>
<div class="line"><span class="lineno">  314</span>    uint64_t start_lsn = last_checkpoint.checkpoint_lsn + 1;</div>
<div class="line"><span class="lineno">  315</span>    uint64_t current_lsn = start_lsn;</div>
<div class="line"><span class="lineno">  316</span> </div>
<div class="line"><span class="lineno">  317</span>    std::cout &lt;&lt; <span class="stringliteral">&quot;从检查点LSN &quot;</span> &lt;&lt; last_checkpoint.checkpoint_lsn &lt;&lt; <span class="stringliteral">&quot; 开始恢复&quot;</span></div>
<div class="line"><span class="lineno">  318</span>              &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  319</span> </div>
<div class="line"><span class="lineno">  320</span>    <span class="comment">// 2. 分析未完成事务</span></div>
<div class="line"><span class="lineno">  321</span>    std::unordered_map&lt;TransactionId, bool&gt; txn_status;</div>
<div class="line"><span class="lineno">  322</span>    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><span class="lineno">  323</span>      <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  324</span>        LogRecord record = <a class="code hl_function" href="classsqlcc_1_1WALManager.html#ac9b839bfd1a04c5e1195263a16354662">ReadRecordFromDisk</a>(current_lsn);</div>
<div class="line"><span class="lineno">  325</span>        <span class="keywordflow">if</span> (record.lsn == 0)</div>
<div class="line"><span class="lineno">  326</span>          <span class="keywordflow">break</span>; <span class="comment">// 没有更多记录</span></div>
<div class="line"><span class="lineno">  327</span> </div>
<div class="line"><span class="lineno">  328</span>        <span class="comment">// 跟踪事务状态</span></div>
<div class="line"><span class="lineno">  329</span>        <span class="keywordflow">if</span> (record.type == <a class="code hl_enumvalue" href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a19aad9f2fe3ce0023298ab83f7e75775">LogRecordType::BEGIN</a>) {</div>
<div class="line"><span class="lineno">  330</span>          txn_status[record.txn_id] = <span class="keyword">false</span>; <span class="comment">// 未提交</span></div>
<div class="line"><span class="lineno">  331</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (record.type == <a class="code hl_enumvalue" href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a1d0ba376e273b9d622641124d8c59264">LogRecordType::COMMIT</a>) {</div>
<div class="line"><span class="lineno">  332</span>          txn_status[record.txn_id] = <span class="keyword">true</span>; <span class="comment">// 已提交</span></div>
<div class="line"><span class="lineno">  333</span>          std::cout &lt;&lt; <span class="stringliteral">&quot;事务 &quot;</span> &lt;&lt; record.txn_id &lt;&lt; <span class="stringliteral">&quot; 已提交&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  334</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (record.type == <a class="code hl_enumvalue" href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a8d12a2ca7e5a64036d7251a3eda51a38">LogRecordType::ABORT</a>) {</div>
<div class="line"><span class="lineno">  335</span>          txn_status.erase(record.txn_id); <span class="comment">// 已中止</span></div>
<div class="line"><span class="lineno">  336</span>          std::cout &lt;&lt; <span class="stringliteral">&quot;事务 &quot;</span> &lt;&lt; record.txn_id &lt;&lt; <span class="stringliteral">&quot; 已中止&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  337</span>        }</div>
<div class="line"><span class="lineno">  338</span> </div>
<div class="line"><span class="lineno">  339</span>        current_lsn++;</div>
<div class="line"><span class="lineno">  340</span>      } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;) {</div>
<div class="line"><span class="lineno">  341</span>        <span class="keywordflow">break</span>; <span class="comment">// 到达日志文件末尾</span></div>
<div class="line"><span class="lineno">  342</span>      }</div>
<div class="line"><span class="lineno">  343</span>    }</div>
<div class="line"><span class="lineno">  344</span> </div>
<div class="line"><span class="lineno">  345</span>    <span class="comment">// 3. 回滚未提交的事务</span></div>
<div class="line"><span class="lineno">  346</span>    uint64_t max_recover_lsn = <a class="code hl_function" href="classsqlcc_1_1WALManager.html#a44127a7061391dc317ac29b31dbad139">ReplayLog</a>(start_lsn, current_lsn - 1);</div>
<div class="line"><span class="lineno">  347</span>    std::cout &lt;&lt; <span class="stringliteral">&quot;恢复完成，处理了 &quot;</span> &lt;&lt; (max_recover_lsn - start_lsn + 1)</div>
<div class="line"><span class="lineno">  348</span>              &lt;&lt; <span class="stringliteral">&quot; 条日志记录&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  349</span>    std::cout &lt;&lt; <span class="stringliteral">&quot;检查点后的LSN范围: &quot;</span> &lt;&lt; start_lsn &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; max_recover_lsn</div>
<div class="line"><span class="lineno">  350</span>              &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  351</span> </div>
<div class="line"><span class="lineno">  352</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  353</span>  } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;e) {</div>
<div class="line"><span class="lineno">  354</span>    std::cerr &lt;&lt; <span class="stringliteral">&quot;崩溃恢复失败: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  355</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  356</span>  }</div>
<div class="line"><span class="lineno">  357</span>}</div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_a44127a7061391dc317ac29b31dbad139"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#a44127a7061391dc317ac29b31dbad139">sqlcc::WALManager::ReplayLog</a></div><div class="ttdeci">uint64_t ReplayLog(uint64_t from_lsn, uint64_t to_lsn)</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8cpp_source.html#l00372">wal_manager.cpp:372</a></div></div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_a978a77f99e2ed7e461362508d691974c"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#a978a77f99e2ed7e461362508d691974c">sqlcc::WALManager::GetLastCheckpoint</a></div><div class="ttdeci">CheckpointState GetLastCheckpoint() const</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8cpp_source.html#l00299">wal_manager.cpp:299</a></div></div>
<div class="ttc" id="anamespacesqlcc_html_a20e2bc332b842e56915ec0aecffa57e3a19aad9f2fe3ce0023298ab83f7e75775"><div class="ttname"><a href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a19aad9f2fe3ce0023298ab83f7e75775">sqlcc::LogRecordType::BEGIN</a></div><div class="ttdeci">@ BEGIN</div></div>
<div class="ttc" id="anamespacesqlcc_html_a20e2bc332b842e56915ec0aecffa57e3a1d0ba376e273b9d622641124d8c59264"><div class="ttname"><a href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a1d0ba376e273b9d622641124d8c59264">sqlcc::LogRecordType::COMMIT</a></div><div class="ttdeci">@ COMMIT</div></div>
<div class="ttc" id="anamespacesqlcc_html_a20e2bc332b842e56915ec0aecffa57e3a8d12a2ca7e5a64036d7251a3eda51a38"><div class="ttname"><a href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a8d12a2ca7e5a64036d7251a3eda51a38">sqlcc::LogRecordType::ABORT</a></div><div class="ttdeci">@ ABORT</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a8d12a2ca7e5a64036d7251a3eda51a38">sqlcc::ABORT</a>, <a class="el" href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a19aad9f2fe3ce0023298ab83f7e75775">sqlcc::BEGIN</a>, <a class="el" href="wal__manager_8h_source.html#l00070">sqlcc::CheckpointState::checkpoint_lsn</a>, <a class="el" href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a1d0ba376e273b9d622641124d8c59264">sqlcc::COMMIT</a>, <a class="el" href="wal__manager_8cpp_source.html#l00299">GetLastCheckpoint()</a>, <a class="el" href="wal__manager_8h_source.html#l00058">sqlcc::LogRecord::lsn</a>, <a class="el" href="wal__manager_8cpp_source.html#l00519">ReadRecordFromDisk()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00372">ReplayLog()</a>, <a class="el" href="wal__manager_8h_source.html#l00053">sqlcc::LogRecord::txn_id</a>, and <a class="el" href="wal__manager_8h_source.html#l00054">sqlcc::LogRecord::type</a>.</p>

</div>
</div>
<a id="a44127a7061391dc317ac29b31dbad139" name="a44127a7061391dc317ac29b31dbad139"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44127a7061391dc317ac29b31dbad139">&#9670;&#160;</a></span>ReplayLog()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t sqlcc::WALManager::ReplayLog </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>from_lsn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>to_lsn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>重演事务日志 </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">from_lsn</td><td>起始LSN </td></tr>
    <tr><td class="paramname">to_lsn</td><td>结束LSN </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>成功重演到最后一个LSN </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00372">372</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  372</span>                                                                 {</div>
<div class="line"><span class="lineno">  373</span>  uint64_t last_replay_lsn = from_lsn - 1;</div>
<div class="line"><span class="lineno">  374</span> </div>
<div class="line"><span class="lineno">  375</span>  std::vector&lt;LogRecord&gt; logs_to_replay = <a class="code hl_function" href="classsqlcc_1_1WALManager.html#a113274a046fac18d8dfae2dd43518ff3">ReadLogRange</a>(from_lsn, to_lsn);</div>
<div class="line"><span class="lineno">  376</span> </div>
<div class="line"><span class="lineno">  377</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;record : logs_to_replay) {</div>
<div class="line"><span class="lineno">  378</span>    <span class="comment">// 重演逻辑：根据日志记录恢复数据状态</span></div>
<div class="line"><span class="lineno">  379</span>    <span class="keywordflow">switch</span> (record.type) {</div>
<div class="line"><span class="lineno">  380</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a15a8022d0ed9cd9c2a2e756822703eb4">LogRecordType::UPDATE</a>:</div>
<div class="line"><span class="lineno">  381</span>      <span class="comment">// TODO: 在存储引擎中应用更新操作</span></div>
<div class="line"><span class="lineno">  382</span>      std::cout &lt;&lt; <span class="stringliteral">&quot;重演更新: &quot;</span> &lt;&lt; record.ToString() &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  383</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  384</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a61ee777e7f71dc466c3b2c685d8d313b">LogRecordType::INSERT</a>:</div>
<div class="line"><span class="lineno">  385</span>      <span class="comment">// TODO: 在存储引擎中应用插入操作</span></div>
<div class="line"><span class="lineno">  386</span>      std::cout &lt;&lt; <span class="stringliteral">&quot;重演插入: &quot;</span> &lt;&lt; record.ToString() &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  387</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  388</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a32f68a60cef40faedbc6af20298c1a1e">LogRecordType::DELETE</a>:</div>
<div class="line"><span class="lineno">  389</span>      <span class="comment">// TODO: 在存储引擎中应用删除操作</span></div>
<div class="line"><span class="lineno">  390</span>      std::cout &lt;&lt; <span class="stringliteral">&quot;重演删除: &quot;</span> &lt;&lt; record.ToString() &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  391</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  392</span>    <span class="comment">// BEGIN/COMMIT/ABORT 不需要重演，它们是事务控制</span></div>
<div class="line"><span class="lineno">  393</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a29f42a1755feb702481dc9c2bc0b57bb">LogRecordType::COMPENSATE</a>:</div>
<div class="line"><span class="lineno">  394</span>      std::cout &lt;&lt; <span class="stringliteral">&quot;重演补偿: &quot;</span> &lt;&lt; record.ToString() &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  395</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  396</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  397</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  398</span>    }</div>
<div class="line"><span class="lineno">  399</span> </div>
<div class="line"><span class="lineno">  400</span>    last_replay_lsn = record.lsn;</div>
<div class="line"><span class="lineno">  401</span>  }</div>
<div class="line"><span class="lineno">  402</span> </div>
<div class="line"><span class="lineno">  403</span>  <span class="keywordflow">return</span> last_replay_lsn;</div>
<div class="line"><span class="lineno">  404</span>}</div>
<div class="ttc" id="aclasssqlcc_1_1WALManager_html_a113274a046fac18d8dfae2dd43518ff3"><div class="ttname"><a href="classsqlcc_1_1WALManager.html#a113274a046fac18d8dfae2dd43518ff3">sqlcc::WALManager::ReadLogRange</a></div><div class="ttdeci">std::vector&lt; LogRecord &gt; ReadLogRange(uint64_t from_lsn, uint64_t to_lsn)</div><div class="ttdef"><b>Definition</b> <a href="wal__manager_8cpp_source.html#l00225">wal_manager.cpp:225</a></div></div>
<div class="ttc" id="anamespacesqlcc_html_a20e2bc332b842e56915ec0aecffa57e3a15a8022d0ed9cd9c2a2e756822703eb4"><div class="ttname"><a href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a15a8022d0ed9cd9c2a2e756822703eb4">sqlcc::LogRecordType::UPDATE</a></div><div class="ttdeci">@ UPDATE</div></div>
<div class="ttc" id="anamespacesqlcc_html_a20e2bc332b842e56915ec0aecffa57e3a29f42a1755feb702481dc9c2bc0b57bb"><div class="ttname"><a href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a29f42a1755feb702481dc9c2bc0b57bb">sqlcc::LogRecordType::COMPENSATE</a></div><div class="ttdeci">@ COMPENSATE</div></div>
<div class="ttc" id="anamespacesqlcc_html_a20e2bc332b842e56915ec0aecffa57e3a32f68a60cef40faedbc6af20298c1a1e"><div class="ttname"><a href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a32f68a60cef40faedbc6af20298c1a1e">sqlcc::LogRecordType::DELETE</a></div><div class="ttdeci">@ DELETE</div></div>
<div class="ttc" id="anamespacesqlcc_html_a20e2bc332b842e56915ec0aecffa57e3a61ee777e7f71dc466c3b2c685d8d313b"><div class="ttname"><a href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a61ee777e7f71dc466c3b2c685d8d313b">sqlcc::LogRecordType::INSERT</a></div><div class="ttdeci">@ INSERT</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a29f42a1755feb702481dc9c2bc0b57bb">sqlcc::COMPENSATE</a>, <a class="el" href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a32f68a60cef40faedbc6af20298c1a1e">sqlcc::DELETE</a>, <a class="el" href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a61ee777e7f71dc466c3b2c685d8d313b">sqlcc::INSERT</a>, <a class="el" href="wal__manager_8cpp_source.html#l00225">ReadLogRange()</a>, and <a class="el" href="namespacesqlcc.html#a20e2bc332b842e56915ec0aecffa57e3a15a8022d0ed9cd9c2a2e756822703eb4">sqlcc::UPDATE</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00308">RecoverFromLog()</a>.</p>

</div>
</div>
<a id="a5759f104e31d16be56a63582116f9320" name="a5759f104e31d16be56a63582116f9320"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5759f104e31d16be56a63582116f9320">&#9670;&#160;</a></span>ResetMetrics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sqlcc::WALManager::ResetMetrics </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>重置性能指标 </p>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00421">421</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  421</span>                              {</div>
<div class="line"><span class="lineno">  422</span>  std::unique_lock&lt;std::mutex&gt; lock(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ab2499798b907264408950dc8889ee785">metrics_mutex_</a>);</div>
<div class="line"><span class="lineno">  423</span>  <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#a887731813def7012ce73bad9c6940e4d">metrics_</a> = {</div>
<div class="line"><span class="lineno">  424</span>      0, 0, 0, std::chrono::microseconds(0), std::chrono::microseconds(0),</div>
<div class="line"><span class="lineno">  425</span>      0, 0};</div>
<div class="line"><span class="lineno">  426</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8h_source.html#l00299">metrics_</a>, and <a class="el" href="wal__manager_8h_source.html#l00298">metrics_mutex_</a>.</p>

</div>
</div>
<a id="ab3e4dcb4d837804376152765cf02465e" name="ab3e4dcb4d837804376152765cf02465e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3e4dcb4d837804376152765cf02465e">&#9670;&#160;</a></span>VerifyLogIntegrity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sqlcc::WALManager::VerifyLogIntegrity </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>验证日志完整性 </p><dl class="section return"><dt>Returns</dt><dd>是否完整 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00436">436</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  436</span>                                          {</div>
<div class="line"><span class="lineno">  437</span>  <span class="comment">// 临时注释掉会导致编译错误的部分</span></div>
<div class="line"><span class="lineno">  438</span>  <span class="comment">// ReadRecordFromDisk(0);</span></div>
<div class="line"><span class="lineno">  439</span> </div>
<div class="line"><span class="lineno">  440</span>  <span class="comment">// TODO: 实现日志完整性验证逻辑</span></div>
<div class="line"><span class="lineno">  441</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  442</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac381c367099dca75a6ea373c963c8154" name="ac381c367099dca75a6ea373c963c8154"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac381c367099dca75a6ea373c963c8154">&#9670;&#160;</a></span>WriteCheckpointToDisk()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void sqlcc::WALManager::WriteCheckpointToDisk </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structsqlcc_1_1CheckpointState.html">CheckpointState</a> &amp;&#160;</td>
          <td class="paramname"><em>checkpoint</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>写入检查点到磁盘 </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">checkpoint</td><td>检查点状态 </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00527">527</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  527</span>                                                                        {</div>
<div class="line"><span class="lineno">  528</span>  std::ofstream chk_file(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ae73989908d2b65d7a9c7b671143c8db3">checkpoint_file_path_</a>, std::ios::binary);</div>
<div class="line"><span class="lineno">  529</span>  <span class="keywordflow">if</span> (!chk_file) {</div>
<div class="line"><span class="lineno">  530</span>    <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;无法打开检查点文件进行写入: &quot;</span> +</div>
<div class="line"><span class="lineno">  531</span>                             <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ae73989908d2b65d7a9c7b671143c8db3">checkpoint_file_path_</a>);</div>
<div class="line"><span class="lineno">  532</span>  }</div>
<div class="line"><span class="lineno">  533</span> </div>
<div class="line"><span class="lineno">  534</span>  <span class="comment">// 写入检查点基本信息</span></div>
<div class="line"><span class="lineno">  535</span>  chk_file.write(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(&amp;checkpoint.checkpoint_lsn),</div>
<div class="line"><span class="lineno">  536</span>                 <span class="keyword">sizeof</span>(checkpoint.checkpoint_lsn));</div>
<div class="line"><span class="lineno">  537</span> </div>
<div class="line"><span class="lineno">  538</span>  <span class="keyword">auto</span> timestamp_count = checkpoint.timestamp.time_since_epoch().count();</div>
<div class="line"><span class="lineno">  539</span>  chk_file.write(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(&amp;timestamp_count),</div>
<div class="line"><span class="lineno">  540</span>                 <span class="keyword">sizeof</span>(timestamp_count));</div>
<div class="line"><span class="lineno">  541</span> </div>
<div class="line"><span class="lineno">  542</span>  <span class="comment">// TODO: 写入页面状态快照</span></div>
<div class="line"><span class="lineno">  543</span> </div>
<div class="line"><span class="lineno">  544</span>  chk_file.flush();</div>
<div class="line"><span class="lineno">  545</span>  std::cout &lt;&lt; <span class="stringliteral">&quot;检查点已写入磁盘，LSN: &quot;</span> &lt;&lt; checkpoint.checkpoint_lsn</div>
<div class="line"><span class="lineno">  546</span>            &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  547</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8h_source.html#l00279">checkpoint_file_path_</a>, <a class="el" href="wal__manager_8h_source.html#l00070">sqlcc::CheckpointState::checkpoint_lsn</a>, and <a class="el" href="wal__manager_8h_source.html#l00071">sqlcc::CheckpointState::timestamp</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00259">CreateCheckpoint()</a>.</p>

</div>
</div>
<a id="a7fad927d4160a13c505e6266523bc21f" name="a7fad927d4160a13c505e6266523bc21f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7fad927d4160a13c505e6266523bc21f">&#9670;&#160;</a></span>WriteRecordsToDisk()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t sqlcc::WALManager::WriteRecordsToDisk </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structsqlcc_1_1LogRecord.html">LogRecord</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>records</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>实际写入日志记录到磁盘 </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">records</td><td>要写入的记录 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>成功写入的记录数量 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wal__manager_8cpp_source.html#l00479">479</a> of file <a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  479</span>                                                                         {</div>
<div class="line"><span class="lineno">  480</span>  <span class="keywordflow">if</span> (records.empty()) {</div>
<div class="line"><span class="lineno">  481</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  482</span>  }</div>
<div class="line"><span class="lineno">  483</span> </div>
<div class="line"><span class="lineno">  484</span>  std::ofstream log_file(<a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ad29ce65e1ab00ed57e4d79c65a99e44a">log_file_path_</a>, std::ios::binary | std::ios::app);</div>
<div class="line"><span class="lineno">  485</span>  <span class="keywordflow">if</span> (!log_file) {</div>
<div class="line"><span class="lineno">  486</span>    <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;无法打开日志文件进行写入: &quot;</span> + <a class="code hl_variable" href="classsqlcc_1_1WALManager.html#ad29ce65e1ab00ed57e4d79c65a99e44a">log_file_path_</a>);</div>
<div class="line"><span class="lineno">  487</span>  }</div>
<div class="line"><span class="lineno">  488</span> </div>
<div class="line"><span class="lineno">  489</span>  <span class="keywordtype">size_t</span> written = 0;</div>
<div class="line"><span class="lineno">  490</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;record : records) {</div>
<div class="line"><span class="lineno">  491</span>    <span class="comment">// 简化二进制格式：</span></div>
<div class="line"><span class="lineno">  492</span>    <span class="comment">// txn_id (8字节) + type (1字节) + key长度 (4字节) + key + lsn (8字节)</span></div>
<div class="line"><span class="lineno">  493</span>    uint8_t record_type = <span class="keyword">static_cast&lt;</span>uint8_t<span class="keyword">&gt;</span>(record.type);</div>
<div class="line"><span class="lineno">  494</span>    uint32_t key_length = record.key.length();</div>
<div class="line"><span class="lineno">  495</span> </div>
<div class="line"><span class="lineno">  496</span>    log_file.write(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(&amp;record.txn_id),</div>
<div class="line"><span class="lineno">  497</span>                   <span class="keyword">sizeof</span>(record.txn_id));</div>
<div class="line"><span class="lineno">  498</span>    log_file.write(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(&amp;record_type),</div>
<div class="line"><span class="lineno">  499</span>                   <span class="keyword">sizeof</span>(record_type));</div>
<div class="line"><span class="lineno">  500</span>    log_file.write(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(&amp;key_length),</div>
<div class="line"><span class="lineno">  501</span>                   <span class="keyword">sizeof</span>(key_length));</div>
<div class="line"><span class="lineno">  502</span>    log_file.write(record.key.data(), key_length);</div>
<div class="line"><span class="lineno">  503</span>    log_file.write(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(&amp;record.lsn),</div>
<div class="line"><span class="lineno">  504</span>                   <span class="keyword">sizeof</span>(record.lsn));</div>
<div class="line"><span class="lineno">  505</span> </div>
<div class="line"><span class="lineno">  506</span>    <span class="comment">// TODO: 写入old_value, new_value和timestamp</span></div>
<div class="line"><span class="lineno">  507</span>    <span class="comment">// 这里为了简化先只写入核心字段</span></div>
<div class="line"><span class="lineno">  508</span> </div>
<div class="line"><span class="lineno">  509</span>    <span class="keywordflow">if</span> (log_file.fail()) {</div>
<div class="line"><span class="lineno">  510</span>      <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;写入日志记录失败&quot;</span>);</div>
<div class="line"><span class="lineno">  511</span>    }</div>
<div class="line"><span class="lineno">  512</span>    written++;</div>
<div class="line"><span class="lineno">  513</span>  }</div>
<div class="line"><span class="lineno">  514</span> </div>
<div class="line"><span class="lineno">  515</span>  log_file.flush();</div>
<div class="line"><span class="lineno">  516</span>  <span class="keywordflow">return</span> written;</div>
<div class="line"><span class="lineno">  517</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wal__manager_8h_source.html#l00278">log_file_path_</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00172">ForceFlush()</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a19894317c8741ac6fc0f8b786ee58774" name="a19894317c8741ac6fc0f8b786ee58774"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19894317c8741ac6fc0f8b786ee58774">&#9670;&#160;</a></span>buffer_cv_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::condition_variable sqlcc::WALManager::buffer_cv_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00288">288</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00217">AsyncFlush()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00579">AsyncFlushThread()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00114">Log()</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00142">LogBatch()</a>.</p>

</div>
</div>
<a id="a584e5bde2e635c8f4ae2891b4931f306" name="a584e5bde2e635c8f4ae2891b4931f306"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a584e5bde2e635c8f4ae2891b4931f306">&#9670;&#160;</a></span>buffer_mutex_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::mutex sqlcc::WALManager::buffer_mutex_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00287">287</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00217">AsyncFlush()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00579">AsyncFlushThread()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00172">ForceFlush()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00114">Log()</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00142">LogBatch()</a>.</p>

</div>
</div>
<a id="ae73989908d2b65d7a9c7b671143c8db3" name="ae73989908d2b65d7a9c7b671143c8db3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae73989908d2b65d7a9c7b671143c8db3">&#9670;&#160;</a></span>checkpoint_file_path_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string sqlcc::WALManager::checkpoint_file_path_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00279">279</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00446">InitializeLogFile()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00549">ReadCheckpointFromDisk()</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00527">WriteCheckpointToDisk()</a>.</p>

</div>
</div>
<a id="adee37c93eff7a274e513b99cf03d0e48" name="adee37c93eff7a274e513b99cf03d0e48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adee37c93eff7a274e513b99cf03d0e48">&#9670;&#160;</a></span>checkpoint_history_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="structsqlcc_1_1CheckpointState.html">CheckpointState</a>&gt; sqlcc::WALManager::checkpoint_history_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00302">302</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00259">CreateCheckpoint()</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00303">GetCheckpointHistory()</a>.</p>

</div>
</div>
<a id="aee6091ea8e78617abbf407fe1bd4c5a8" name="aee6091ea8e78617abbf407fe1bd4c5a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee6091ea8e78617abbf407fe1bd4c5a8">&#9670;&#160;</a></span>checkpoint_mutex_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::mutex sqlcc::WALManager::checkpoint_mutex_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00303">303</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00259">CreateCheckpoint()</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00303">GetCheckpointHistory()</a>.</p>

</div>
</div>
<a id="ad91c54a36b39904be7e76f75ae7177a4" name="ad91c54a36b39904be7e76f75ae7177a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad91c54a36b39904be7e76f75ae7177a4">&#9670;&#160;</a></span>flush_interval_ms_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t sqlcc::WALManager::flush_interval_ms_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00295">295</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00579">AsyncFlushThread()</a>.</p>

</div>
</div>
<a id="a28811031c46cf1a8e034f41df715bb24" name="a28811031c46cf1a8e034f41df715bb24"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28811031c46cf1a8e034f41df715bb24">&#9670;&#160;</a></span>flush_thread_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt;std::thread&gt; sqlcc::WALManager::flush_thread_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00291">291</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

</div>
</div>
<a id="a6cfa568f0b7af8a6635b714b55b9f557" name="a6cfa568f0b7af8a6635b714b55b9f557"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6cfa568f0b7af8a6635b714b55b9f557">&#9670;&#160;</a></span>force_sync_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool sqlcc::WALManager::force_sync_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00294">294</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00114">Log()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00142">LogBatch()</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00080">WALManager()</a>.</p>

</div>
</div>
<a id="aea56fc2bf3f9578154648a3f4ff033dc" name="aea56fc2bf3f9578154648a3f4ff033dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea56fc2bf3f9578154648a3f4ff033dc">&#9670;&#160;</a></span>last_checkpoint_lsn_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;uint64_t&gt; sqlcc::WALManager::last_checkpoint_lsn_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00283">283</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00259">CreateCheckpoint()</a>.</p>

</div>
</div>
<a id="a41b15908cf56904fb80a53040b4d0025" name="a41b15908cf56904fb80a53040b4d0025"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41b15908cf56904fb80a53040b4d0025">&#9670;&#160;</a></span>last_flushed_lsn_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;uint64_t&gt; sqlcc::WALManager::last_flushed_lsn_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00282">282</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00259">CreateCheckpoint()</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00172">ForceFlush()</a>.</p>

</div>
</div>
<a id="a70af2e5f3016d1d2470f18e9c0077897" name="a70af2e5f3016d1d2470f18e9c0077897"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70af2e5f3016d1d2470f18e9c0077897">&#9670;&#160;</a></span>log_buffer_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="structsqlcc_1_1LogRecord.html">LogRecord</a>&gt; sqlcc::WALManager::log_buffer_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00286">286</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00579">AsyncFlushThread()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00172">ForceFlush()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00114">Log()</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00142">LogBatch()</a>.</p>

</div>
</div>
<a id="ad29ce65e1ab00ed57e4d79c65a99e44a" name="ad29ce65e1ab00ed57e4d79c65a99e44a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad29ce65e1ab00ed57e4d79c65a99e44a">&#9670;&#160;</a></span>log_file_path_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string sqlcc::WALManager::log_file_path_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00278">278</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00446">InitializeLogFile()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00080">WALManager()</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00479">WriteRecordsToDisk()</a>.</p>

</div>
</div>
<a id="a887731813def7012ce73bad9c6940e4d" name="a887731813def7012ce73bad9c6940e4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a887731813def7012ce73bad9c6940e4d">&#9670;&#160;</a></span>metrics_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsqlcc_1_1WALManager_1_1WALMetrics.html">WALMetrics</a> sqlcc::WALManager::metrics_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00299">299</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00259">CreateCheckpoint()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00172">ForceFlush()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00114">Log()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00142">LogBatch()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00421">ResetMetrics()</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00080">WALManager()</a>.</p>

</div>
</div>
<a id="ab2499798b907264408950dc8889ee785" name="ab2499798b907264408950dc8889ee785"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2499798b907264408950dc8889ee785">&#9670;&#160;</a></span>metrics_mutex_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::mutex sqlcc::WALManager::metrics_mutex_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00298">298</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00259">CreateCheckpoint()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00172">ForceFlush()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00114">Log()</a>, <a class="el" href="wal__manager_8cpp_source.html#l00142">LogBatch()</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00421">ResetMetrics()</a>.</p>

</div>
</div>
<a id="ab66b3d926874bb5347f825e4c73f627b" name="ab66b3d926874bb5347f825e4c73f627b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab66b3d926874bb5347f825e4c73f627b">&#9670;&#160;</a></span>next_lsn_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;uint64_t&gt; sqlcc::WALManager::next_lsn_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00281">281</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00475">GenerateLSN()</a>.</p>

</div>
</div>
<a id="a58f40b4c377e50777666692517c16fb3" name="a58f40b4c377e50777666692517c16fb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58f40b4c377e50777666692517c16fb3">&#9670;&#160;</a></span>stop_flush_thread_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;bool&gt; sqlcc::WALManager::stop_flush_thread_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wal__manager_8h_source.html#l00292">292</a> of file <a class="el" href="wal__manager_8h_source.html">wal_manager.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="wal__manager_8cpp_source.html#l00579">AsyncFlushThread()</a>, and <a class="el" href="wal__manager_8cpp_source.html#l00080">WALManager()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/<a class="el" href="wal__manager_8h_source.html">wal_manager.h</a></li>
<li>src/transaction_manager/<a class="el" href="wal__manager_8cpp_source.html">wal_manager.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacesqlcc.html">sqlcc</a></li><li class="navelem"><a class="el" href="classsqlcc_1_1WALManager.html">WALManager</a></li>
    <li class="footer">Generated on Wed Nov 26 2025 00:11:12 for SQLCC by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
