# SQLCC数据库管理系统 - 设计文档总览

本文档提供SQLCC数据库管理系统各子系统的需求和设计总览，作为系统整体架构的导航参考。

## 版本信息

**当前版本**：0.6.0
**发布日期**：2025-11-28

- [📝 变更日志](../CHANGELOG.md)
- [📄 版本综合报告](../reports/0.6.0版本综合报告.md)
- [📊 API文档](../doxygen/html/index.html)
- [🔧 API文档生成说明](../API文档生成说明.md)

## 系统架构概览

SQLCC采用模块化的客户端-服务器架构，主要包含以下核心子系统：

1. **SQL解析器** - 负责SQL语句的词法分析和语法分析，生成抽象语法树
2. **SQL执行器** - 执行解析后的SQL语句，管理表元数据和约束
3. **存储引擎** - 负责数据的物理存储和管理，包括页面管理和缓冲池
4. **事务管理器** - 确保事务的ACID特性，提供并发控制和死锁检测
5. **配置管理器** - 管理系统配置参数，提供配置加载和访问功能
6. **网络模块** - 实现客户端-服务器通信，支持远程访问
7. **性能测试框架** - 提供性能测试工具和指标收集功能，支持多种测试场景

## 1. SQL解析器子系统

### 需求概述
- 将用户输入的SQL文本解析为结构化的抽象语法树(AST)
- 支持多种SQL语句类型，包括DDL、DML、DCL和事务控制语句
- 提供清晰的语法错误提示和错误处理机制
- 支持AST的遍历和访问，便于后续处理

### 设计特点
- 采用经典的编译器前端架构，包括词法分析器(Lexer)和语法分析器(Parser)
- 生成的AST支持多种SQL语句类型的结构化表示
- 提供Token类表示SQL语言中的各种标记元素
- 模块化设计便于扩展和维护

### 核心组件
- **Lexer** - 词法分析器，将SQL文本分解为Token流
- **Parser** - 语法分析器，将Token流构建为抽象语法树
- **Token** - 表示SQL语言中的各种标记
- **AST Nodes** - 抽象语法树节点类

### 详细文档
- [SQL解析器总体设计](docs/design/sql_parser/sql_parser-总体设计.md)
- [Parser详细设计](docs/design/sql_parser/parser.md)
- [Lexer详细设计](docs/design/sql_parser/lexer.md)
- [Token详细设计](docs/design/sql_parser/token.md)
- [AST Nodes详细设计](docs/design/sql_parser/ast_nodes.md)

## 2. SQL执行器子系统

### 需求概述
- 执行各类SQL语句，包括DDL、DML、DCL和事务控制语句
- 管理表结构和约束信息
- 执行记录的增删改查操作
- 在数据操作前后验证表约束
- 与事务管理器集成，提供ACID事务保证

### 设计特点
- 模块化设计，不同类型的SQL语句执行分离到独立方法
- 完善的异常处理机制确保系统稳定
- 线程安全设计通过互斥锁保护并发访问
- 易于扩展，支持添加新的SQL语句类型

### 核心组件
- **SqlExecutor** - SQL执行器主类
- **TableMetadata** - 表元数据管理
- **Record** - 记录操作类
- **ConstraintExecutor** - 约束验证
- **WhereCondition** - 查询条件处理

### 详细文档
- [SQL执行器总体设计](docs/design/sql_executor/sql_executor-总体设计.md)
- [SqlExecutor详细设计](docs/design/sql_executor/sql_executor.md)
- [TableMetadata详细设计](docs/design/sql_executor/table_metadata.md)
- [Record详细设计](docs/design/sql_executor/record.md)
- [ConstraintExecutor详细设计](docs/design/sql_executor/constraint_executor.md)
- [WhereCondition详细设计](docs/design/sql_executor/where_condition.md)
- [SqlExecutionException详细设计](docs/design/sql_executor/sql_execution_exception.md)

## 3. 存储引擎子系统

### 需求概述
- 管理数据库的物理存储结构
- 提供页面管理机制，支持页面的创建、获取、刷新和删除
- 实现缓冲池管理，提高I/O性能
- 管理索引结构，支持高效数据检索
- 确保数据的持久性和一致性

### 设计特点
- 基于页面的存储模型，便于管理和优化
- 缓冲池机制减少磁盘I/O操作
- 集成索引管理器，提供高效的数据访问路径
- 统一的存储接口，便于上层组件访问

### 核心组件
- **StorageEngine** - 存储引擎主类
- **DiskManager** - 磁盘管理器，负责与物理存储交互
- **BufferPool** - 缓冲池，管理内存中的页面缓存
- **IndexManager** - 索引管理器，提供索引操作
- **BPlusTreeIndex** - B+树索引实现，支持高效数据检索

### 详细文档
- [存储引擎总体设计](docs/design/storage_engine/storage_engine-总体设计.md)
- [StorageEngine详细设计](docs/design/storage_engine/storage_engine.md)
- [DiskManager详细设计](docs/design/storage_engine/disk_manager.md)
- [BufferPool详细设计](docs/design/storage_engine/buffer_pool.md)
- [Page详细设计](docs/design/storage_engine/page.md)
- [B+树索引实现](docs/design/storage_engine/storage_engine_design.md#4-b树索引实现)

## 4. 事务管理器子系统

### 需求概述
- 实现ACID事务特性，确保数据一致性和完整性
- 提供并发控制机制，协调多个事务的执行
- 实现死锁检测和处理机制
- 提供预写日志(WAL)机制，确保事务持久性
- 支持多种事务隔离级别

### 设计特点
- 基于两阶段锁协议(2PL)实现事务并发控制
- 预写日志机制确保事务持久性和系统崩溃恢复
- 基于等待图的死锁检测算法
- 灵活的隔离级别支持

### 核心组件
- **TransactionManager** - 事务管理器主类
- **Transaction** - 表示单个事务的状态和信息
- **LogEntry** - 日志条目，用于预写日志机制
- 锁管理和死锁检测模块

### 详细文档
- [事务管理器总体设计](docs/design/transaction_manager/transaction_manager-总体设计.md)
- [TransactionManager详细设计](docs/design/transaction_manager/transaction_manager.md)
- [Transaction详细设计](docs/design/transaction_manager/transaction.md)
- [LogEntry详细设计](docs/design/transaction_manager/log_entry.md)

## 5. 配置管理器子系统

### 需求概述
- 管理系统配置参数，提供统一的配置访问接口
- 支持配置的加载、解析和验证
- 提供配置参数的类型转换和默认值处理
- 支持配置的动态更新和持久化

### 设计特点
- 统一的配置管理接口，简化配置访问
- 类型安全的配置值处理
- 支持多种配置源，如配置文件、环境变量等
- 配置验证机制确保配置合法性

### 核心组件
- **ConfigManager** - 配置管理器主类
- **ConfigValue** - 配置值类，提供类型转换和验证

### 详细文档
- [配置管理器总体设计](docs/design/config_manager/config_manager-总体设计.md)
- [ConfigManager详细设计](docs/design/config_manager/config_manager.md)
- [ConfigValue详细设计](docs/design/config_manager/config_value.md)

## 6. 网络模块子系统

### 需求概述
- 实现客户端-服务器通信协议
- 支持并发连接处理，提高系统吞吐量
- 提供请求序列化和响应反序列化功能
- 实现网络错误处理和连接管理
- 确保数据传输的安全性和可靠性

### 设计特点
- 分层设计，清晰的模块划分
- 支持多线程并发处理客户端连接
- 高效的序列化机制，优化网络传输性能
- 完善的错误处理和连接恢复机制

### 核心组件
- 服务器和客户端通信组件
- 请求处理和响应生成模块
- 序列化库
- 连接池和线程管理

### 详细文档
- [网络通信架构设计](docs/design/network/NetworkArchitecture.md)

## 7. 性能测试框架子系统

### 需求概述
- 提供性能测试工具和框架，支持多种测试场景
- 收集和分析性能指标，如吞吐量、延迟等
- 支持测试结果的持久化和可视化
- 提供配置选项，支持测试参数的灵活调整
- 支持业务场景测试，模拟实际使用情况

### 设计特点
- 模块化设计，便于扩展和维护
- 支持多种测试类型，包括基准测试、负载测试、压力测试等
- 提供详细的延迟统计，包括P50、P95、P99、P99.9等分位数
- 支持测试结果的格式化输出，便于分析和比较
- 提供命令行参数支持，便于自动化测试

### 核心组件
- **PerformanceTestBase** - 性能测试基类，提供通用的测试工具和指标收集功能
- **SimplePerformanceTest** - 简单性能测试实现，用于测试基本功能
- **BusinessScenarioTest** - 业务场景测试实现，模拟实际业务使用情况
- **HighConcurrencyTransactionTest** - 高并发事务测试实现，测试系统在高并发场景下的性能
- **LargeDataQueryTest** - 大数据量查询测试实现，测试系统在大数据场景下的查询性能
- **PerformanceMonitor** - 性能监控器，用于实时收集和分析性能数据
- **TestReporter** - 测试报告生成器，生成详细的性能测试报告和图表

### 详细文档
- [性能测试框架设计](docs/performance/performance_test_framework_design.md)

## 文档索引

| 子系统 | 主要文档 | 位置 |
|-------|---------|------|
| 系统架构 | Architecture.md | docs/design/ |
| SQL解析器 | sql_parser-总体设计.md | docs/design/sql_parser/ |
| SQL执行器 | sql_executor-总体设计.md | docs/design/sql_executor/ |
| 存储引擎 | storage_engine-总体设计.md | docs/design/storage_engine/ |
| 事务管理器 | transaction_manager-总体设计.md | docs/design/transaction_manager/ |
| 配置管理器 | config_manager-总体设计.md | docs/design/config_manager/ |
| 网络模块 | NetworkArchitecture.md | docs/design/network/ |
| 性能测试框架 | performance_test_framework_design.md | docs/performance/ |

## 后续工作

- 完善各子系统的详细设计文档
- 加强跨子系统交互的文档说明
- 添加性能测试和优化指南
- 提供部署和配置文档
- 更新系统升级和迁移指南
- 完善用户手册和使用指南

## 用户文档

- [📖 用户手册](../用户手册.md)
- [🚀 部署和配置指南](../部署和配置指南.md)
- [🔄 系统升级和迁移指南](../系统升级和迁移指南.md)
- [🔧 故障排除指南](../故障排除指南.md)

## 0.6.0版本更新内容

- 实现完整的B+树索引系统，支持插入、删除、搜索和范围搜索
- 增强存储引擎性能和稳定性，优化页面管理和缓冲池
- 实现完整的性能测试框架，支持多种测试场景
- 添加详细的延迟统计，包括P50、P95、P99、P99.9等分位数
- 支持测试结果的持久化和格式化输出
- 添加业务场景测试，模拟实际使用情况
- 提供命令行参数支持，便于自动化测试
- 完善SQL执行器，增强SELECT、INSERT、UPDATE、DELETE操作
- 增强网络模块，支持客户端连接管理和认证流程
- 优化配置管理系统，支持动态参数调整
- 改进错误处理机制，提供更清晰的错误信息
- 完善文档体系，包括API文档和设计文档