# 《数据库原理》期末大作业：AI驱动的微型数据库系统开发

> 🎯 **专为大二学生设计的数据库开发指南** - 从零开始，用AI辅助构建你自己的数据库系统！

## 📋 项目概览

### 基本要求
- **性质**：个人或小组项目（2-4人，需明确分工并独立提交报告）
- **周期**：4-8周（28天）
- **难度**：⭐⭐⭐⭐（需要扎实的编程基础和耐心）

### 🎯 核心目标
从零开始，全程利用AI辅助，交付一个具备完整核心功能的可执行数据库系统，帮助你：
- 初步掌握 AI 辅助的软件工程方法
- 深入理解数据库系统的原理和实现
- 培养系统设计和开发能力

### ⚠️ 关键要求
**必须自研存储引擎，禁止使用SQLite等现成库！**

## 📦 最终交付清单
| 交付物 | 要求 | 说明 |
|--------|------|------|
| 源码 | 完整可编译 | Gitee仓库 |
| 可执行程序 | 可直接运行 | 包含启动脚本 |
| 实验报告 | 详细完整 | PDF格式 |
| 演示视频 | 5分钟以内 | MP4格式，≤100MB |

## 🛠️ 技术栈选择（全部国产化）

| 类别 | 可选方案 | 推荐理由 |
|------|----------|----------|
| 开发语言 | **C++** / Java / Go | 选择你最熟悉、AI训练语料最多的 |
| AI-IDE | **字节 Trae** / 阿里 Qoder / 腾讯 CodeBuddy | Trae多模态，无限时长 |
| 大模型 | IDE内置模型 或 通义/混元/豆包API | 根据使用习惯选择 |
| 构建与测试 | Maven, JUnit 5 / CppUnit | 阿里Java开发手册 |
| 存储 | 自研页式文件管理 | 使用本地文件 |

## 🎯 功能要求（必须通过自动化测试）

### 模块功能清单

| 模块 | 核心功能要求 | 自动化测试基准 |
|------|--------------|----------------|
| **存储引擎** | 8KB定长页，空间管理，定/变长记录 | 10万次INSERT后，文件体积≤1.2倍理论值 |
| **SQL解析** | 解析指定6种SQL语句，生成正确AST | 全部测试SQL解析通过，AST打印正确 |
| **索引** | B+树，单字段唯一，支持=, >, <, 范围查询 | 100万主键下，点查页面访问≤4次 |
| **CRUD** | 插入、点查、范围扫描、更新、删除 | 1-10万行数据，单操作耗时<5ms (SSD) |
| **事务** | WAL(预写日志) + 两阶段锁，读已提交隔离级别 | 10线程并发转账1000次，无丢失更新 |
| **工具** | 交互式命令行isql，支持-f执行脚本 | 执行1000行脚本无崩溃 |

## 🗓️ 四周开发路线图

### 第一周：环境与存储引擎
**核心任务**：
- ✅ 搭建开发环境
- ✅ 创建项目仓库
- ✅ 实现页式文件管理

**AI辅助提示词示例**：
> "用Java NIO编写一个8KB定长页的文件管理器，包含allocatePage和freePage方法，并提供JUnit测试用例。"

**小技巧**：让AI生成BufferPool类的骨架，并基于LRU算法实现页面淘汰。

**验收点**：
- Git仓库建立完成
- 准备10分钟项目介绍演讲

### 第二周：SQL解析与索引
**核心任务**：
- ✅ 实现SQL解析器
- ✅ 实现B+树索引

**AI辅助提示词示例**：
> "根据以下EBNF语法，生成ANTLR4的g4文件，并创建一个遍历AST的Visitor基类。"

**小技巧**：在Qoder中，使用Repo Wiki让AI理解整个项目结构。

**验收点**：
- 通过20条SQL解析测试
- 索引单测通过，支持1M~1G数据量

### 第三周：CRUD与事务
**核心任务**：
- ✅ 实现执行器
- ✅ 实现WAL和锁管理器

**AI辅助提示词示例**：
> "编写一个Java类，实现两阶段锁协议，使用ConcurrentHashMap管理S锁(共享锁)和X锁(排他锁)。提供简单的加锁/解锁接口。"

**小技巧**：将编译错误直接粘贴给AI，让它自我修正。

**验收点**：
- 通过CRUD性能测试
- 课堂isql转账DEMO演示

### 第四周：集成测试与报告
**核心任务**：
- ✅ 系统联调
- ✅ 撰写报告
- ✅ 录制视频

**AI辅助提示词示例**：
> "为我生成一个20页的LaTeX实验报告模板，包含摘要、引言、系统架构图、ER图、事务时序图、性能评估和结论等章节。"

**小技巧**：使用AI将性能测试数据自动转换为LaTeX表格和图表。

**验收点**：
- 现场随机SQL测试
- 提交所有最终材料

## 🚀 详细开发教程

### 第一步：环境搭建与项目初始化

**AI引导提示词**：
> "我是一名学生，要开始一个Java数据库项目。请为我创建一个标准的Maven项目结构，包含src/main/java, src/test/java目录，并在pom.xml中配置JUnit 5的依赖。"

**可能遇到的问题**：
- AI生成的pom.xml版本可能过旧
- **解决方案**：检查并手动指定较新的版本号

**测试验证**：
```bash
mvn compile    # 确保项目可以正常编译
mvn test       # 确保测试通过（即使测试是空的）
```

### 第二步：存储引擎实现（W1核心）

**AI引导提示词**：
> "请实现一个Page类，代表一个8KB的字节缓冲区。再实现一个DiskManager类，使用FileChannel将Page对象读写到磁盘文件‘data.db’中。要求支持按页ID随机读写。"

**进阶提示**：
> "请为Page类添加一个位图，用于追踪页内哪些槽位是空闲的，并实现insertRecord和deleteRecord方法。"

**测试验证**：
- 单元测试：创建100个页，写入后读出，验证数据一致性
- 性能测试：运行10万次INSERT测试，检查文件大小是否符合要求

### 第三步：SQL解析器实现（W2核心）

**最佳实践**：使用AI生成ANTLR4语法文件

**AI引导提示词**：
> "以下是SQL子集的EBNF描述，请为我生成对应的ANTLR4语法文件(Sql.g4)，并生成Java词法分析和语法分析器。"

**后续开发**：
> "根据生成的语法，创建一个SqlVisitor实现，将SELECT语句解析成自定义的SelectStatement对象。"

**常见问题解决**：
- 语法歧义：将出错的SQL样例和错误信息反馈给AI，要求修正

### 第四步：B+树索引实现（W2难点）

**AI引导提示词**：
> "请用Java实现一个B+树索引的核心结构。假设键是整数，值是长整型的页ID。请实现insert, search和rangeSearch方法。"

**关键设计**：
> "我的B+树节点需要存储到之前实现的8KB Page中。请帮我设计一个BPlusTreeLeafNode类，它能够序列化和反序列化到一个Page的字节数组中。"

### 第五步：事务实现（W3难点）

**WAL实现提示词**：
> "实现一个简单的预写日志（WAL）类。它有一个logTransaction方法，接收事务ID和一系列修改操作，并将其追加到日志文件。还有一个recover方法，用于系统崩溃后重做已提交的事务。"

**锁管理器提示词**：
> "实现一个LockManager，提供acquireLock和releaseLock方法。锁类型分SHARED和EXCLUSIVE。需要处理锁兼容性和死锁预防。"

## 🧪 测试与评估指南

### 分层测试策略

| 测试类型 | 测试内容 | 工具方法 |
|----------|----------|----------|
| **单元测试** | 每个核心类的正常和边界情况 | JUnit, CppUnit |
| **集成测试** | 模块间的交互测试 | 自定义测试用例 |
| **系统测试** | 全套自动化测试脚本 | 教师提供的测试套件 |
| **压力测试** | 超大数据量和高并发场景 | 自定义压力测试 |

### 性能评估方法

**基准测试**：
```java
// 使用JMH进行性能测试
@Benchmark
public void testInsertPerformance() {
    // 插入性能测试
}
```

**性能分析工具**：
- JVisualVM：找出性能瓶颈
- Async-Profiler：分析IO、锁竞争等问题

**AI辅助分析**：
> "请分析这份数据库性能测试报告，指出可能的性能瓶颈，并给出优化建议。"

### 正确性验证方法

1. **与SQLite对比**：最有效的方法，对比查询结果
2. **模糊测试**：用AI生成大量随机SQL语句进行测试
3. **一致性检查**：事务测试后检查完整性约束

## 📝 最终交付核对表

- [ ] **源码仓库**：Gitee平台，main分支可编译 (`mvn clean package`)
- [ ] **可执行程序**：db-1.0-SNAPSHOT.jar 及启动脚本 (isql.sh/bat)
- [ ] **实验报告**：PDF格式，包含详细的AI辅助记录
- [ ] **演示视频**：≤100MB，5分钟，展示核心功能
- [ ] **AI辅助记录表**：按要求填写AI-log.xlsx

## 📚 文档资源

- **文档中心**：[SQLCC文档中心](docs/index.md) - 所有文档的导航入口
- **API文档**：[Doxygen生成的API文档](docs/doxygen/html/index.html) - 需切换到docs分支查看
- **存储引擎设计**：[存储引擎设计文档](docs/storage_engine_design.md)
- **单元测试文档**：[单元测试框架与内容](docs/unit_testing.md)
- **分支说明**：[项目分支使用指南](docs/BRANCHES.md) - 了解主分支和文档分支的区别

### 📖 如何查看API文档

本项目使用两个分支管理代码和文档：

1. **主分支 (master)**：包含源代码和基础文档，不包含Doxygen生成的API文档
2. **文档分支 (docs)**：包含主分支所有内容以及完整的API文档

查看完整API文档，请执行：
```bash
git checkout docs
# 然后打开 docs/doxygen/html/index.html
```

## 👥 参与贡献

欢迎同学们参与贡献！具体流程如下：

1. **Fork 本仓库**
2. **新建 Feat_xxx 分支**
3. **提交代码**
4. **新建 Pull Request**

## 🌟 学习资源

- **多语言支持**：使用 Readme_XXX.md 支持不同语言
- **Gitee官方博客**：blog.gitee.com
- **开源项目探索**：https://gitee.com/explore
- **GVP项目**：Gitee最有价值开源项目
- **使用手册**：https://gitee.com/help
- **封面人物**：展示Gitee会员风采

---

**💡 温馨提示**：本项目的核心价值在于亲手实践。AI是强大的助手，但真正的理解来自于你自己的思考和调试过程。祝各位同学开发顺利，收获满满！
有问题可以在课堂上直接反馈，或者发邮件联系： 1820393151@qq.com

---

## 🆕 项目版本状态与文档说明

### 当前版本状态

**版本号**：v0.2.2  
**更新日期**：2025年11月05日  
**开发状态**：第一阶段完成，文档体系完善

### 文档体系完善

本项目已建立完整的文档体系，包括：

1. **[Architecture.md](Architecture.md)** - 系统架构设计文档
   - 详细描述了存储引擎、SQL解析、索引、CRUD、事务和工具六个模块
   - 使用Why-What-Who-How分析框架解释设计决策
   - 提供了模块关系图和初步实现思路

2. **[docs/index.md](docs/index.md)** - 文档导航中心
   - 提供了完整的文档导航和分类
   - 为不同背景读者设计了专门的阅读路径
   - 包含AI辅助编程学习者和DBMS学习者的阅读指南

3. **[Guide.md](Guide.md)** - 开发指南
   - 详细的开发步骤和AI提示词示例
   - 新增了版本升级指南和未来版本计划
   - 包含实用的AI提示词和命令示例

### 针对不同读者的阅读路径

#### AI辅助编程学习者
如果您希望学习如何利用AI工具构建数据库系统，建议按以下顺序阅读：
1. 首先阅读本README.md了解项目整体要求
2. 然后阅读[Guide.md](Guide.md)学习具体的开发步骤和AI提示词
3. 接着阅读[Architecture.md](Architecture.md)了解系统设计思路
4. 最后参考[docs/index.md](docs/index.md)查找特定技术细节

#### DBMS学习者
如果您希望了解和使用SQLCC数据库系统，建议按以下顺序阅读：
1. 首先阅读[Architecture.md](Architecture.md)了解系统架构和功能
2. 然后阅读本README.md了解项目特性和使用方法
3. 接着参考[docs/index.md](docs/index.md)查找特定功能的API文档
4. 最后阅读[Guide.md](Guide.md)了解实现细节和开发过程

#### 快速体验者
如果您只想快速体验SQLCC数据库系统，建议：
1. 阅读本README.md的"项目概览"和"功能要求"部分
2. 参考文档中心的[快速开始指南](docs/index.md#快速开始)
3. 直接尝试示例SQL操作

### 项目结构更新

```
sqlcc/
├── README.md              # 项目说明（本文档）
├── Architecture.md        # 系统架构设计文档
├── Guide.md              # 开发指南（含版本升级指南）
├── docs/                 # 文档目录
│   ├── index.md          # 文档导航中心
│   ├── storage_engine_design.md  # 存储引擎设计文档
│   └── unit_testing.md   # 单元测试文档
├── include/              # 头文件
├── src/                  # 源代码
├── tests/                # 测试代码
└── scripts/              # 脚本文件
```

### 未来版本计划

#### v0.3.0计划特性
- SQL解析器实现：完成SQL语句的解析和AST生成
- B+树索引实现：完成B+树索引结构和操作
- CRUD操作实现：完成基本的数据操作功能
- 事务系统实现：完成WAL日志和锁管理

#### v0.4.0计划特性
- 查询优化器：实现基本的查询优化策略
- 并发控制：完善多线程并发访问控制
- 性能优化：优化系统性能和资源使用
- 工具完善：完善命令行工具和管理功能

---

**最后更新：2025年11月05日 | 作者：yinglichina, 李莹**
yinglichina@gmail.com,  1820393151@qq.com